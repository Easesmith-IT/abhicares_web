import{r as a,_ as K,j as s,d as N,u as se,e as te}from"./index-MFQKCb7o.js";import{R as ae}from"./index.esm-CqPrJGFm.js";/* empty css                   */import{u as ne}from"./useAuthorization-Y1Z3uJ_s.js";import{L as re}from"./Loader-CooIHcb6.js";import{u as Q}from"./usePatchApiReq-C7rNSsLh.js";import{u as C}from"./index.esm-Df65-zPW.js";import{W as ie}from"./Wrapper-EuhUHBtD.js";import{f as H}from"./index-D5Lf-kgZ.js";import"./iconBase-BO1x0Pa9.js";import"./useDispatch-DbBSbkF0.js";import"./logo -C1Nz5jdc.js";const ce="_wrapper_qlkv1_1",oe="_modal_qlkv1_27",le="_heading_container_qlkv1_47",de="_form_qlkv1_59",he="_input_container_qlkv1_73",ue="_input_qlkv1_73",pe="_button_wrapper_qlkv1_105",me="_button_qlkv1_105",_e="_partner_container_qlkv1_131",xe="_partner_qlkv1_131",fe="_partner_left_qlkv1_165",p={wrapper:ce,modal:oe,heading_container:le,form:de,input_container:he,input:ue,button_wrapper:pe,button:me,partner_container:_e,partner:xe,partner_left:fe},je=({setIsModalOpen:n,serviceId:l="",bookingId:m,getBooking:i})=>{const[c,y]=a.useState([]),{res:r,fetchData:_,isLoading:x}=C();ne();const e=async()=>{_(`/admin/get-seller-list/${l}`)};a.useEffect(()=>{e()},[]),a.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&y(r==null?void 0:r.data.data)},[r]);const{res:o,fetchData:u}=Q(),f=async h=>{await u(`/admin/allot-seller-order/${h}`,{bookingId:m})};return a.useEffect(()=>{((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(console.log("assignPartnerRes",o),K.success("Order assigned to seller successfully"),i(),n(!1))},[o]),s.jsx("div",{className:p.wrapper,children:s.jsxs("div",{className:p.modal,children:[s.jsxs("div",{className:p.heading_container,children:[s.jsx("h4",{children:"Assigne Partner"}),s.jsx("div",{className:p.d_flex,children:s.jsx(ae,{onClick:()=>n(!1),cursor:"pointer",size:26})})]}),s.jsxs("div",{className:p.partner_container,children:[!x&&c.length===0&&s.jsx("p",{children:"No seller found for selected service."}),x&&c.length===0&&s.jsx(re,{}),c&&c.map(h=>s.jsx("div",{className:p.partner,children:s.jsxs("div",{className:p.partner_left,children:[s.jsxs("p",{children:["Seller Name: ",h.name]}),s.jsxs("p",{children:["Seller Phone: ",h.phone]}),s.jsx("button",{onClick:()=>f(h._id),className:p.button,children:"Assign"})]})}))]})]})})},ve="_wrapper_ohei2_1",ge="_left_div_ohei2_23",Ne="_select_ohei2_37",ye="_info_ohei2_49",Se="_heading_ohei2_59",we="_button_ohei2_71",Ae="_container_ohei2_91",Ce="_item_ohei2_115",$e="_img_ohei2_139",Ie="_right_div_ohei2_149",Te="_right_div_top_ohei2_157",qe="_right_div_bottom_ohei2_159",De="_d_flex_ohei2_181",Ee="_location_container_ohei2_269",Pe="_location_container_left_ohei2_297",t={wrapper:ve,left_div:ge,select:Ne,info:ye,heading:Se,button:we,container:Ae,item:Ce,img:$e,right_div:Ie,right_div_top:Te,right_div_bottom:qe,d_flex:De,location_container:Ee,location_container_left:Pe},Le=({google:n,location:l,sellerStatus:m,bookingStatus:i})=>{var I,S,T;const{res:c,fetchData:y,isLoading:r}=C(),[_,x]=a.useState(null),[e,o]=a.useState(!1),u={width:"100%",height:"500px"},f={lat:l.user[0],lng:l.user[1]},h={lat:l.seller[0],lng:l.seller[1]},$=async()=>{const j=`${l.seller[0]},${l.seller[1]}`,v=`${l.user[0]},${l.user[1]}`;y(`/admin/get-the-path-from-source-to-destination?sourceCoordinates=${j}&destinationCoordinates=${v}`)};return a.useEffect(()=>{$()},[]),a.useEffect(()=>{var j,v;((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&x((v=(j=c==null?void 0:c.data.routes[0])==null?void 0:j.overview_polyline)==null?void 0:v.points)},[c]),a.useEffect(()=>{o(!(m==="out-of-delivery"&&i==="started"))},[m,i]),s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsxs(N.Map,{google:n,zoom:14,style:u,initialCenter:f,children:[s.jsx(N.Marker,{position:f,title:"User",icon:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}}),s.jsx(N.Marker,{position:h,title:"Seller",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}),_&&s.jsx(N.Polyline,{path:_&&((T=(S=(I=n==null?void 0:n.maps)==null?void 0:I.geometry)==null?void 0:S.encoding)==null?void 0:T.decodePath(_)),strokeColor:"#4285F4",strokeOpacity:1,strokeWeight:4})]})}),e&&s.jsx("div",{style:{border:"2px solid",position:"absolute",bottom:0,right:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px",zIndex:10},children:"The Seller is not started yet!"})]})},Me=N.GoogleApiWrapper({apiKey:"AIzaSyB_ZhYrt0hw7zB74UYGhh4Wt_IkltFzo-I"})(Le),Ke=()=>{var P,L,M,k,z,B,F,U;const{res:n,fetchData:l,isLoading:m}=C(),{res:i,fetchData:c,isLoading:y}=C(),{res:r,fetchData:_}=Q(),{id:x}=se(),[e,o]=a.useState(null),[u,f]=a.useState({time:"",distance:""}),[h,$]=a.useState(0),[I,S]=a.useState(0),[T,j]=a.useState(0),v=te(),[g,D]=a.useState((e==null?void 0:e.status)||""),[Z,E]=a.useState(!1),q=async()=>{l(`/admin/get-booking-details/${x}`)};a.useEffect(()=>{((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(o(n==null?void 0:n.data.bookingDetails),D(n==null?void 0:n.data.bookingDetails.status))},[n]);const J=async()=>{g!==""&&await _(`/admin/update-seller-order-status/${e._id}`,{status:g})};console.log("booking 123",e);const X=async()=>{try{if(e){const d=`${e.currentLocation.location[0]},${e.currentLocation.location[1]}`,A=`${e.userAddress.location.coordinates[0]},${e.userAddress.location.coordinates[1]}`;c(`/admin/get-the-distance-routes?origins=${d}&destinations=${A}`)}}catch(d){console.log(d)}};a.useEffect(()=>{m||X()},[m]),a.useEffect(()=>{var d,A,V,W,b,O,G,Y;((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&f({distance:(W=(V=(A=(d=i==null?void 0:i.data)==null?void 0:d.rows[0])==null?void 0:A.elements[0])==null?void 0:V.distance)==null?void 0:W.text,time:(Y=(G=(O=(b=i==null?void 0:i.data)==null?void 0:b.rows[0])==null?void 0:O.elements[0])==null?void 0:G.duration)==null?void 0:Y.text})},[i]),a.useEffect(()=>{q()},[]),a.useEffect(()=>{var d;$((e==null?void 0:e.orderValue)*18/100),S(Number(h)+Number(e==null?void 0:e.orderValue)),e!=null&&e.couponId&&j((e==null?void 0:e.orderValue)*((d=e==null?void 0:e.couponId)==null?void 0:d.offPercentage)/100)},[e==null?void 0:e.orderValue,e==null?void 0:e.couponId,h,v]);const R=()=>{E(!0)};let w=(e==null?void 0:e.bookingTime)&&new Date(e==null?void 0:e.bookingTime),ee=w&&(w==null?void 0:w.getHours());return console.log("hours",ee),a.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&(console.log("bookingDetailRes",r),K.success("Booking status changed successfully"),q())},[r]),s.jsxs(s.Fragment,{children:[s.jsx(ie,{children:s.jsxs("div",{children:[e&&s.jsxs("div",{className:t.wrapper,children:[s.jsxs("div",{className:t.left_div,children:[s.jsxs("div",{className:t.info,children:[s.jsxs("div",{children:[s.jsxs("h4",{children:["Booking Id: ",e==null?void 0:e.bookingId]}),e.autoAssigned&&s.jsx("p",{style:{color:"green"},children:s.jsx("i",{children:"Auto Assigned"})}),s.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"10px"},children:[s.jsx("h4",{children:"Update Status"}),s.jsxs("select",{value:g,onChange:d=>D(()=>d.target.value),className:t.select,name:"status",id:"status",children:[s.jsx("option",{value:"",children:"Select"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]}),s.jsx("button",{onClick:J,className:t.button,style:{marginLeft:"10px"},children:"Update"})]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Payment Status: ",e==null?void 0:e.paymentStatus]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Amount: ",(P=e==null?void 0:e.refundInfo)==null?void 0:P.amount]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Status: ",(L=e==null?void 0:e.refundInfo)==null?void 0:L.status]})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["Date of Booking:"," ",H(new Date(e.bookingDate),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Time of Booking: ",e.bookingTime&&H(new Date(e==null?void 0:e.bookingTime),"hh:mm aa")]}),(!e.sellerId||g==="not-alloted")&&s.jsx("button",{onClick:R,className:t.button,children:"Assign to partner"}),e.sellerId&&g!=="not-alloted"&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h5",{children:"Assigned to Seller"}),s.jsx("p",{children:e.sellerId.name}),s.jsx("p",{children:e.sellerId.phone})]})]})]}),s.jsx("h5",{className:t.heading,children:"Products"}),s.jsx("div",{className:t.container,children:s.jsxs("div",{className:t.item,children:[s.jsxs("div",{children:[s.jsx("img",{className:t.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:"product"}),s.jsxs("div",{children:[s.jsx("h6",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?"Package":"Product"})]})]}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]})]})})]}),s.jsxs("div",{className:t.right_div,children:[s.jsxs("div",{className:t.right_div_top,children:[s.jsx("h5",{children:"Booking Summary"}),s.jsxs("div",{className:t.heading,children:[s.jsx("p",{children:"Descriptions"}),s.jsx("p",{children:"Amounts"})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Sub Total :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.itemTotalValue]})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Tax and other charges :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.itemTotalTax]})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Discount :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.itemTotalDiscount]})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Total Amount :"}),s.jsxs("p",{children:["₹",e.orderValue]})]})]}),s.jsxs("div",{className:t.right_div_bottom,children:[s.jsx("h5",{children:"Customer Details"}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Name :"}),s.jsx("p",{children:(M=e==null?void 0:e.userId)==null?void 0:M.name})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Phone :"}),s.jsx("p",{children:(k=e==null?void 0:e.userId)==null?void 0:k.phone})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Address :"}),s.jsx("p",{children:`${e.userAddress.addressLine},${e.userAddress.landmark},${e.userAddress.pincode}`})]})]})]})]}),e&&s.jsxs("div",{className:t.location_container,children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Current Location"}),s.jsx("p",{children:"Service Man is on the way..."}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("h6",{children:"Distance :"}),s.jsx("span",{children:u.distance!==""&&u.distance})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("h6",{children:"Time :"}),s.jsx("span",{children:u.time!==""&&u.time})]})]}),s.jsx("div",{children:s.jsx(Me,{sellerStatus:(z=e.currentLocation)==null?void 0:z.status,bookingStatus:e.status,location:{user:(F=(B=e.userAddress)==null?void 0:B.location)==null?void 0:F.coordinates,seller:(U=e.currentLocation)==null?void 0:U.location}})})]})]})}),Z&&s.jsx(je,{setIsModalOpen:E,serviceId:e.product?e.product.serviceId:e.package.serviceId,bookingId:e._id,getBooking:q})]})};export{Ke as default};
