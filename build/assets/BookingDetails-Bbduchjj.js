import{h as P,r as c,_ as A,j as s,n as B,u as R,e as F}from"./index-if6yrKUM.js";import{I as V}from"./InvoiceModal-W0dW-yBl.js";import{u as E}from"./usePostApiReq-b9urQUdc.js";import{W as U}from"./WebsiteWrapper-Czc46hzn.js";import{A as W,u as Y}from"./index.esm-CdsNXrcl.js";import{f as D}from"./index-NDDHiImd.js";import{A as G}from"./AddReviewModal-C3EoWzOZ.js";import{c as b}from"./Shared.module-DD54I-nI.js";import"./index.esm-2CfOHty1.js";import"./iconBase-lzS6dEZZ.js";import"./jspdf-html2canvas.min-CG1HE9vY.js";import"./index-rw__0qL1.js";import"./useDispatch-D0Me-TH-.js";import"./rolling-white-BBE_8u84.js";import"./Button-CDO2tyIS.js";import"./index.esm-DsWS68ZJ.js";import"./usePatchApiReq-I7ZOyaKg.js";const Q="_booking_details_2rluy_1",H="_booking_details_left_2rluy_23",J="_booking_details_right_2rluy_31",K="_order_details_2rluy_39",X="_d_flex_2rluy_39",Z="_delivery_details_2rluy_51",ss="_booking_details_right_top_2rluy_53",es="_h4_2rluy_71",os="_buttons_container_2rluy_97",as="_button_2rluy_97",ns="_red_2rluy_131",ts="_progress_2rluy_161",ls="_status_container_2rluy_203",rs="_product_contaner_2rluy_213",cs="_product_2rluy_213",ds="_img_2rluy_247",is="_info_2rluy_257",_s="_p_2rluy_161",us="_link_2rluy_293",ps="_modal_wrapper_2rluy_329",hs="_modal_2rluy_329",gs="_button_wrapper_2rluy_373",xs="_yes_2rluy_401",bs="_no_2rluy_411",n={booking_details:Q,booking_details_left:H,booking_details_right:J,order_details:K,d_flex:X,delivery_details:Z,booking_details_right_top:ss,h4:es,buttons_container:os,button:as,red:ns,progress:ts,status_container:ls,product_contaner:rs,product:cs,img:ds,info:is,p:_s,link:us,modal_wrapper:ps,modal:hs,button_wrapper:gs,yes:xs,no:bs},fs="_modal_overlay_9z2w0_1",js="_modal_open_9z2w0_21",ks="_modal_close_9z2w0_33",ys="_modal_wrapper_9z2w0_41",vs="_modal_9z2w0_1",ms="_p_9z2w0_99",Ns="_mt_9z2w0_111",Is="_rating_container_9z2w0_119",ws="_button_9z2w0_141",Ds="_input_box_9z2w0_165",Ts="_input_9z2w0_165",r={modal_overlay:fs,modal_open:js,modal_close:ks,modal_wrapper:ys,modal:vs,p:ms,mt:Ns,rating_container:Is,button:ws,input_box:Ds,input:Ts},Cs=({isAddTicketModalOpen:e,setIsAddTicketModalOpen:p,booking:_,item:o})=>{var k,C,m,O,x,$,y,N,I,v;const{res:d,fetchData:f,isLoading:a}=E(),u=P("userInfo"),h=u==null?void 0:u.id;console.log("booking",_);const[i,g]=c.useState({issue:"",description:"",userId:h,sellerId:((k=_==null?void 0:_.bookingId)==null?void 0:k.sellerId)||"",raisedBy:"customer",bookingId:((C=o==null?void 0:o.bookingId)==null?void 0:C._id)||"",serviceType:o!=null&&o.product?(O=(m=o==null?void 0:o.product)==null?void 0:m.serviceId)==null?void 0:O.categoryId:(($=(x=o==null?void 0:o.package)==null?void 0:x.serviceId)==null?void 0:$.categoryId)||"",ticketType:"Booking",serviceId:o!=null&&o.product?(N=(y=o==null?void 0:o.product)==null?void 0:y.serviceId)==null?void 0:N._id:((v=(I=o==null?void 0:o.package)==null?void 0:I.serviceId)==null?void 0:v._id)||"",date:D(new Date,"dd/MM/yyyy")});console.log("ticketInfo",i);const j=l=>{const{name:w,value:M}=l.target;g({...i,[w]:M})},T=async()=>{if(!i.issue||!i.description){A.error("All fields are required");return}f("/shopping/raise-ticket",i)};return c.useEffect(()=>{((d==null?void 0:d.status)===200||(d==null?void 0:d.status)===201)&&(p(!1),A.success("Ticket raised successfully"))},[d]),s.jsx("div",{className:`${r.modal_overlay} ${e?r.modal_open:r.modal_close}`,children:s.jsxs("div",{className:r.modal_wrapper,children:[s.jsx("button",{onClick:()=>p(!1),className:r.modal_close,children:s.jsx(W,{size:20})}),s.jsxs("div",{className:r.modal,children:[s.jsx("p",{className:r.p,children:"Raised Ticket"}),s.jsxs("div",{className:r.mt,children:[s.jsx("label",{htmlFor:"description",children:"Description"}),s.jsx("div",{className:r.input_box,children:s.jsx("input",{className:r.input,onChange:j,value:i.description,type:"text",name:"description",id:"description",placeholder:"Enter your description"})})]}),s.jsxs("div",{className:r.mt,children:[s.jsx("label",{htmlFor:"issue",children:"Issue"}),s.jsx("div",{className:r.input_box,children:s.jsx("input",{className:r.input,onChange:j,value:i.issue,type:"text",name:"issue",id:"issue",placeholder:"Enter the issue"})})]}),s.jsx("button",{onClick:T,className:r.button,children:a?"Loading...":" Proceed"})]})]})})},Os=({item:e,booking:p})=>{var a,u,h,i,g;const[_,o]=c.useState(!1),[d,f]=c.useState(!1);return console.log("singleBooking",p),console.log("item",e),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n.product,children:[s.jsxs("div",{children:[s.jsx("img",{className:n.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:""}),s.jsxs("small",{children:["Type:",e.package?"Package":"Product"]})]}),s.jsxs("div",{className:n.info,children:[s.jsx("h5",{children:e.package?e.package.name:e.product.name}),s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsx("span",{children:"Delivery Date: "}),e.bookingId.bookingDate&&D(new Date(e.bookingId.bookingDate),"dd-MM-yyyy")]}),s.jsxs("p",{children:[s.jsx("span",{children:"Delivery Time: "}),e.bookingId.bookingTime&&D(new Date(e.bookingId.bookingTime),"hh:mm aa")]})]}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsx("p",{children:s.jsx("span",{className:`${b["t-op-nextlvl"]} ${b.status} ${((a=e==null?void 0:e.bookingId)==null?void 0:a.status)==="cancelled"?b.Cancelled:((u=e==null?void 0:e.bookingId)==null?void 0:u.status)==="completed"?b.Completed:((h=e==null?void 0:e.bookingId)==null?void 0:h.status)==="alloted"?b.alloted:b.OutOfDelivery}`,children:(i=e==null?void 0:e.bookingId)==null?void 0:i.status})}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]}),s.jsx("button",{onClick:()=>o(!0),className:n.button,children:"Add Review"}),s.jsx("button",{onClick:()=>f(!0),className:n.link,children:"Issue with order?"})]})]}),_&&s.jsx(G,{isReviewModalOpen:_,setIsReviewModalOpen:o,isBooking:!0,bookingId:(g=e==null?void 0:e.bookingId)==null?void 0:g._id,serviceId:e.package?e.package._id:e.product._id,serviceType:e.package?"package":"product",getAllReviewsOfUser:()=>{}}),d&&s.jsx(Cs,{isAddTicketModalOpen:d,setIsAddTicketModalOpen:f,booking:p,item:e})]})},Qs=()=>{var v;const{res:e,fetchData:p,isLoading:_}=E(),{res:o,fetchData:d,isLoading:f}=Y(),{state:a}=B();R();const u=F();console.log("state",a);const[h,i]=c.useState({}),[g,j]=c.useState(!1),[T,k]=c.useState(!1),[C,m]=c.useState(0),[O,x]=c.useState(0),[$,y]=c.useState(0),N=async()=>{d(`/shopping/get-product-invoice/${a._id}`)};c.useEffect(()=>{var l;((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(console.log("getProductInvoiceRes",o),i((l=o==null?void 0:o.data)==null?void 0:l.data))},[o]);const I=async()=>{p(`/shopping/change-order-status/${a._id}`,{status:"Cancelled"})};return c.useEffect(()=>{((e==null?void 0:e.status)===200||(e==null?void 0:e.status)===201)&&(A.success("Your order cancelled successfully"),u("/my_bookings"))},[e]),c.useEffect(()=>{N();let l=0;for(const t of a.items)t!=null&&t.product?l=l+Number(t.quantity*t.product.offerPrice):t!=null&&t.package&&(l=l+Number(t.quantity*t.package.offerPrice));const w=Number(l)*18/100;m(w),x(()=>l);const{discountType:M,couponFixedValue:z,offPercentage:q,maxDiscount:S}=a.couponId||{};if(a.couponId)if(M==="fixed")y(z),x(t=>t-Number(z));else{let t=Math.ceil(l*(Number(q)/100));t=t>S?S:t,console.log("offerTotal",t),y(t),x(L=>L-Number(t))}},[a.orderValue,a.couponId]),s.jsx(U,{children:s.jsxs("section",{className:n.booking_details,children:[s.jsxs("div",{className:n.booking_details_left,children:[s.jsxs("div",{className:n.order_details,children:[s.jsx("h4",{className:n.h4,children:"Order Details"}),s.jsxs("div",{className:n.d_flex,children:[s.jsxs("div",{children:[s.jsxs("p",{children:["Order Date: ",D(new Date(a.createdAt),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Order ID: ",a.orderId]}),s.jsxs("p",{children:["Order Status: ",a.status]})]}),s.jsxs("div",{className:n.buttons_container,children:[s.jsx("button",{onClick:()=>j(!0),className:n.button,children:"View Invoice"}),a.status!=="Cancelled"&&s.jsx("button",{onClick:()=>k(!0),className:`${n.button} ${n.red}`,children:"Cancel Order"})]})]})]}),s.jsx("div",{className:n.delivery_details,children:s.jsx("div",{className:n.product_contaner,children:(v=a==null?void 0:a.items)==null?void 0:v.map((l,w)=>s.jsx(Os,{item:l,booking:a}))})})]}),s.jsx("div",{className:n.booking_details_right,children:s.jsxs("div",{className:n.booking_details_right_top,children:[s.jsx("h4",{className:n.h4,children:"Order Total"}),s.jsxs("div",{className:n.d_flex,children:[s.jsxs("div",{children:[s.jsx("p",{children:"Subtotal: "}),s.jsx("p",{children:"Tax and other charges: "}),a.discount>0&&s.jsx("p",{children:"Discount: "}),a.referalDiscount&&s.jsx("p",{children:"Referal Discount: "}),s.jsx("p",{children:s.jsx("b",{children:"Total: "})})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["₹",a.itemTotal]}),s.jsxs("p",{children:[" + ₹",a.tax]}),a.discount>0&&s.jsxs("p",{children:[" - ₹",a.discount]}),a.referalDiscount&&s.jsxs("p",{children:[" - ₹",a.referalDiscount]}),s.jsx("p",{children:s.jsxs("b",{children:["₹",a.orderValue]})})]})]})]})}),g&&s.jsx(V,{state:a,invoice:h,setIsInvoiceModalOpen:j}),T&&s.jsx("div",{className:n.modal_wrapper,children:s.jsxs("div",{className:n.modal,children:[s.jsx("p",{children:"Are you sure to cancel ?"}),s.jsxs("div",{className:n.button_wrapper,children:[s.jsx("button",{onClick:I,className:`${n.button} ${n.yes}`,children:"Yes"}),s.jsx("button",{onClick:()=>k(!1),className:`${n.button} ${n.no}`,children:"No"})]})]})})]})})};export{Qs as default};
