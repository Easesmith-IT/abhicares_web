import{n as F,r as i,e as G,u as Q,_ as z,j as e}from"./index-if6yrKUM.js";import{W as H}from"./Wrapper-DsK8qFe2.js";import{c as u}from"./Shared.module-DD54I-nI.js";import{u as J}from"./usePostApiReq-b9urQUdc.js";import{u as K}from"./index.esm-CdsNXrcl.js";import{f as _}from"./index-NDDHiImd.js";import"./logo -C1Nz5jdc.js";import"./useDispatch-D0Me-TH-.js";import"./iconBase-lzS6dEZZ.js";const R="_wrapper_xu49t_1",X="_left_div_xu49t_19",Y="_select_xu49t_33",Z="_info_xu49t_45",ss="_heading_xu49t_55",es="_container_xu49t_67",ns="_item_xu49t_91",ds="_img_xu49t_115",os="_right_div_xu49t_125",rs="_right_div_top_xu49t_133",cs="_right_div_bottom_xu49t_135",is="_d_flex_xu49t_157",d={wrapper:R,left_div:X,select:Y,info:Z,heading:ss,container:es,item:ns,img:ds,right_div:os,right_div_top:rs,right_div_bottom:cs,d_flex:is},bs=()=>{var N,k,y,D,I,T,C,P,S,$,A,w;const{res:l,fetchData:L,isLoading:ls}=J(),{res:r,fetchData:q,isLoading:as}=K(),{state:p}=F(),[E,M]=i.useState(0),[us,g]=i.useState(0),[hs,j]=i.useState(0),m=G(),[s,U]=i.useState(p||""),[V,v]=i.useState(p==null?void 0:p.status),{id:W}=Q();console.log("stateData items",s.items);const b=async()=>{q(`/admin/get-order-details?orderId=${W}`)};i.useEffect(()=>{b()},[s==null?void 0:s._id]),i.useEffect(()=>{var n,c,a;((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&(console.log("getOrderRes",r),U((n=r==null?void 0:r.data)==null?void 0:n.data),v((a=(c=r==null?void 0:r.data)==null?void 0:c.data)==null?void 0:a.status))},[r]);const B=async n=>{const c=n.target.value;v(()=>c),L(`/admin/change-order-status/${s==null?void 0:s._id}`,{status:c})};return i.useEffect(()=>{((l==null?void 0:l.status)===200||(l==null?void 0:l.status)===201)&&(z.success("Order status changed successfully"),b())},[l]),i.useEffect(()=>{if(s!=null&&s.items&&(s==null?void 0:s.items.length)>0){let n=0;for(const o of s.items)o!=null&&o.product?n=n+Number(o.quantity*o.product.offerPrice):n=n+Number(o.quantity*o.package.offerPrice);g(()=>n);const c=Number(n)*18/100;M(c);const{discountType:a,couponFixedValue:h,offPercentage:t,maxDiscount:x}=(s==null?void 0:s.couponId)||{};if(s!=null&&s.couponId)if(a==="fixed")j(h),g(o=>o-Number(h));else{let o=Math.ceil(n*(Number(t)/100));o=o>x?x:o,console.log("offerTotal",o),j(o),g(f=>f-Number(o))}}},[s==null?void 0:s.orderValue,s==null?void 0:s.couponId,s,s==null?void 0:s.items,E,m]),e.jsx(H,{children:e.jsxs("div",{className:d.wrapper,children:[e.jsxs("div",{className:d.left_div,children:[e.jsxs("div",{className:d.info,children:[e.jsxs("div",{children:[e.jsxs("h4",{children:["Order Id: ",s==null?void 0:s.orderId]}),e.jsx("h5",{children:"Update Status"}),e.jsxs("select",{onChange:B,value:V,className:d.select,name:"status",id:"status",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"OutOfDelivery",children:"OutOfDelivery"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:["Date of Order:"," ",(s==null?void 0:s.createdAt)&&_(new Date(s==null?void 0:s.createdAt),"dd-MM-yyyy")]}),e.jsxs("p",{children:["Time of Order:"," ",(s==null?void 0:s.createdAt)&&_(new Date(s==null?void 0:s.createdAt),"hh:mm aa")]}),e.jsxs("p",{children:["Payment Type: ",s==null?void 0:s.paymentType]}),e.jsxs("p",{children:["No of Left Bookings: ",s==null?void 0:s.No_of_left_bookings]}),e.jsxs("p",{children:["Refund Amount: ",(N=s==null?void 0:s.refundInfo)==null?void 0:N.amount]}),e.jsxs("p",{children:["Refund Status: ",(k=s==null?void 0:s.refundInfo)==null?void 0:k.status]})]})]}),e.jsxs("p",{style:{marginTop:"20px"},children:["Admin Comment: ",s==null?void 0:s.adminComment]}),e.jsx("h5",{className:d.heading,children:"Products"}),e.jsx("div",{className:d.container,children:(y=s==null?void 0:s.items)==null?void 0:y.map((n,c)=>{var a,h,t,x,o,f;return e.jsxs("div",{onClick:()=>{var O;return m(`/admin/bookings/${n!=null&&n.bookingId?(O=n==null?void 0:n.bookingId)==null?void 0:O._id:n==null?void 0:n.bookingId}`)},style:{cursor:"pointer"},className:d.item,children:[e.jsxs("div",{children:[e.jsx("img",{className:d.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${n.package?n.package.imageUrl[0]:n.product.imageUrl[0]}`,alt:"product"}),e.jsxs("div",{children:[e.jsx("h6",{children:n.package?n.package.name:n.product.name}),e.jsx("p",{children:n.package?"Package":"Product"})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0"},children:[e.jsxs("p",{children:[e.jsx("span",{children:"Delivery Date: "}),((a=n==null?void 0:n.bookingId)==null?void 0:a.bookingDate)&&_(new Date(n.bookingId.bookingDate),"dd-MM-yyyy")]}),e.jsxs("p",{children:[e.jsx("span",{children:"Delivery Time: "}),((h=n==null?void 0:n.bookingId)==null?void 0:h.bookingTime)&&_(new Date(n.bookingId.bookingTime),"hh:mm aa")]})]}),e.jsx("p",{children:e.jsx("span",{className:`${u["t-op-nextlvl"]} ${u.status} ${((t=n==null?void 0:n.bookingId)==null?void 0:t.status)==="cancelled"?u.Cancelled:((x=n==null?void 0:n.bookingId)==null?void 0:x.status)==="completed"?u.Completed:((o=n==null?void 0:n.bookingId)==null?void 0:o.status)==="alloted"?u.alloted:u.OutOfDelivery}`,children:(f=n==null?void 0:n.bookingId)==null?void 0:f.status})}),e.jsxs("p",{children:["Qty: ",n.quantity]}),e.jsxs("p",{children:["₹",Number(n.package?n.package.offerPrice:n.product.offerPrice)*Number(n.quantity)]})]},c)})})]}),e.jsxs("div",{className:d.right_div,children:[e.jsxs("div",{className:d.right_div_top,children:[e.jsx("h5",{children:"Order Summary"}),e.jsxs("div",{className:d.heading,children:[e.jsx("p",{children:"Descriptions"}),e.jsx("p",{children:"Amounts"})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Sub Total :"}),e.jsxs("p",{children:["₹",s==null?void 0:s.itemTotal]})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Tax and other charges :"}),e.jsxs("p",{children:["+ ₹",s==null?void 0:s.tax]})]}),(s==null?void 0:s.discount)>0&&e.jsxs("div",{className:d.d_flex,children:[e.jsxs("p",{children:["Discount ('",(D=s==null?void 0:s.couponId)==null?void 0:D.name,"') :"]}),e.jsxs("p",{children:["- ₹",s==null?void 0:s.discount]})]}),(s==null?void 0:s.referalDiscount)>0&&e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Referal Discount :"}),e.jsxs("p",{children:["- ₹",s==null?void 0:s.referalDiscount]})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Total Amount :"}),e.jsxs("p",{children:["₹",s==null?void 0:s.orderValue]})]})]}),e.jsxs("div",{className:d.right_div_bottom,children:[e.jsx("h5",{children:"Customer Details"}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Customer Name :"}),e.jsx("p",{children:(I=s==null?void 0:s.user)==null?void 0:I.name})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Customer Phone :"}),e.jsx("p",{children:(T=s==null?void 0:s.user)==null?void 0:T.phone})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Customer Address :"}),e.jsx("p",{children:`${(P=(C=s==null?void 0:s.user)==null?void 0:C.address)==null?void 0:P.addressLine},${($=(S=s==null?void 0:s.user)==null?void 0:S.address)==null?void 0:$.landmark},${(w=(A=s==null?void 0:s.user)==null?void 0:A.address)==null?void 0:w.pincode}`})]})]})]})]})})};export{bs as default};
