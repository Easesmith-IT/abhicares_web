import{r as t,_ as Y,j as s,d as g,u as X,e as R}from"./index-A8F5s_OX.js";import{R as ee}from"./index.esm-Dl0gbRna.js";/* empty css                   */import{u as se}from"./useAuthorization-DWbqz1ak.js";import{L as te}from"./Loader-CrhVr0MQ.js";import{u as ne}from"./usePatchApiReq-DnAWgL9f.js";import{u as C}from"./index.esm-MqVG0Kzl.js";import{W as ae}from"./Wrapper-Bob4AYsk.js";import{f as G}from"./index-aMvTzC6n.js";import"./iconBase-i28GCwjE.js";import"./logo -C1Nz5jdc.js";const re="_wrapper_qlkv1_1",ie="_modal_qlkv1_27",oe="_heading_container_qlkv1_47",ce="_form_qlkv1_59",le="_input_container_qlkv1_73",de="_input_qlkv1_73",ue="_button_wrapper_qlkv1_105",he="_button_qlkv1_105",pe="_partner_container_qlkv1_131",_e="_partner_qlkv1_131",me="_partner_left_qlkv1_165",_={wrapper:re,modal:ie,heading_container:oe,form:ce,input_container:le,input:de,button_wrapper:ue,button:he,partner_container:pe,partner:_e,partner_left:me},xe=({setIsModalOpen:n,serviceId:l="",bookingId:m,getBooking:r})=>{const[i,y]=t.useState([]),{res:o,fetchData:e,isLoading:f}=C();se();const h=async()=>{e(`/admin/get-seller-list/${l}`)};t.useEffect(()=>{h()},[]),t.useEffect(()=>{((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&y(o==null?void 0:o.data.data)},[o]);const{res:c,fetchData:j}=ne(),v=async p=>{await j(`/admin/allot-seller-order/${p}`,{bookingId:m})};return t.useEffect(()=>{((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&(console.log("assignPartnerRes",c),Y.success("Order assigned to seller successfully"),r(),n(!1))},[c]),s.jsx("div",{className:_.wrapper,children:s.jsxs("div",{className:_.modal,children:[s.jsxs("div",{className:_.heading_container,children:[s.jsx("h4",{children:"Assigne Partner"}),s.jsx("div",{className:_.d_flex,children:s.jsx(ee,{onClick:()=>n(!1),cursor:"pointer",size:26})})]}),s.jsxs("div",{className:_.partner_container,children:[!f&&i.length===0&&s.jsx("p",{children:"No seller found for selected service."}),f&&i.length===0&&s.jsx(te,{}),i&&i.map(p=>s.jsx("div",{className:_.partner,children:s.jsxs("div",{className:_.partner_left,children:[s.jsxs("p",{children:["Seller Name: ",p.name]}),s.jsxs("p",{children:["Seller Phone: ",p.phone]}),s.jsx("button",{onClick:()=>v(p._id),className:_.button,children:"Assign"})]})}))]})]})})},fe="_wrapper_ohei2_1",je="_left_div_ohei2_23",ve="_select_ohei2_37",ge="_info_ohei2_49",ye="_heading_ohei2_59",Ne="_button_ohei2_71",we="_container_ohei2_91",Ae="_item_ohei2_115",Se="_img_ohei2_139",Ce="_right_div_ohei2_149",$e="_right_div_top_ohei2_157",Ie="_right_div_bottom_ohei2_159",ke="_d_flex_ohei2_181",De="_location_container_ohei2_269",be="_location_container_left_ohei2_297",a={wrapper:fe,left_div:je,select:ve,info:ge,heading:ye,button:Ne,container:we,item:Ae,img:Se,right_div:Ce,right_div_top:$e,right_div_bottom:Ie,d_flex:ke,location_container:De,location_container_left:be},Te=({google:n,location:l,sellerStatus:m,bookingStatus:r})=>{var I,N,w;const{res:i,fetchData:y,isLoading:o}=C(),[e,f]=t.useState(null),[h,c]=t.useState(!1),j={width:"100%",height:"500px"},v={lat:l.user[0],lng:l.user[1]},p={lat:l.seller[0],lng:l.seller[1]},$=async()=>{const u=`${l.seller[0]},${l.seller[1]}`,x=`${l.user[0]},${l.user[1]}`;y(`/admin/get-the-path-from-source-to-destination?sourceCoordinates=${u}&destinationCoordinates=${x}`)};return t.useEffect(()=>{$()},[]),t.useEffect(()=>{var u,x;((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&f((x=(u=i==null?void 0:i.data.routes[0])==null?void 0:u.overview_polyline)==null?void 0:x.points)},[i]),t.useEffect(()=>{c(!(m==="out-of-delivery"&&r==="started"))},[m,r]),s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsxs(g.Map,{google:n,zoom:14,style:j,initialCenter:v,children:[s.jsx(g.Marker,{position:v,title:"User",icon:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}}),s.jsx(g.Marker,{position:p,title:"Seller",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}),e&&s.jsx(g.Polyline,{path:e&&((w=(N=(I=n==null?void 0:n.maps)==null?void 0:I.geometry)==null?void 0:N.encoding)==null?void 0:w.decodePath(e)),strokeColor:"#4285F4",strokeOpacity:1,strokeWeight:4})]})}),h&&s.jsx("div",{style:{border:"2px solid",position:"absolute",bottom:0,right:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px",zIndex:1e5},children:"The Seller is not started yet!"})]})},qe=g.GoogleApiWrapper({apiKey:"AIzaSyB_ZhYrt0hw7zB74UYGhh4Wt_IkltFzo-I"})(Te),Ge=()=>{var b,T,q,E,P,L,M,z;const{res:n,fetchData:l,isLoading:m}=C(),{res:r,fetchData:i,isLoading:y}=C(),{id:o}=X(),[e,f]=t.useState(null),[h,c]=t.useState({time:"",distance:""}),[j,v]=t.useState(0),[p,$]=t.useState(0),[I,N]=t.useState(0),w=R(),[u,x]=t.useState((e==null?void 0:e.status)||""),[H,D]=t.useState(!1),k=async()=>{l(`/admin/get-booking-details/${o}`)};t.useEffect(()=>{((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(f(n==null?void 0:n.data.bookingDetails),x(n==null?void 0:n.data.bookingDetails.status))},[n]);const K=async()=>{u!==""&&await bookingDetailFetchData(`/admin/update-seller-order-status/${e._id}`,{status:u})},Q=async()=>{try{if(console.log("booking 123",e),e){const d=`${e.currentLocation.location[0]},${e.currentLocation.location[1]}`,S=`${e.userAddress.location.coordinates[0]},${e.userAddress.location.coordinates[1]}`;i(`/admin/get-the-distance-routes?origins=${d}&destinations=${S}`)}}catch(d){console.log(d)}};t.useEffect(()=>{m||Q()},[m]),t.useEffect(()=>{var d,S,B,F,U,V,W,O;((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&c({distance:(F=(B=(S=(d=r==null?void 0:r.data)==null?void 0:d.rows[0])==null?void 0:S.elements[0])==null?void 0:B.distance)==null?void 0:F.text,time:(O=(W=(V=(U=r==null?void 0:r.data)==null?void 0:U.rows[0])==null?void 0:V.elements[0])==null?void 0:W.duration)==null?void 0:O.text})},[r]),t.useEffect(()=>{k()},[]),t.useEffect(()=>{var d;v((e==null?void 0:e.orderValue)*18/100),$(Number(j)+Number(e==null?void 0:e.orderValue)),e!=null&&e.couponId&&N((e==null?void 0:e.orderValue)*((d=e==null?void 0:e.couponId)==null?void 0:d.offPercentage)/100)},[e==null?void 0:e.orderValue,e==null?void 0:e.couponId,j,w]);const Z=()=>{D(!0)};let A=(e==null?void 0:e.bookingTime)&&new Date(e==null?void 0:e.bookingTime),J=A&&(A==null?void 0:A.getHours());return console.log("hours",J),t.useEffect(()=>{((bookingDetailRes==null?void 0:bookingDetailRes.status)===200||(bookingDetailRes==null?void 0:bookingDetailRes.status)===201)&&(console.log("bookingDetailRes",bookingDetailRes),Y.success("Booking status changed successfully"),k())},[bookingDetailRes]),s.jsxs(s.Fragment,{children:[s.jsx(ae,{children:s.jsxs("div",{children:[e&&s.jsxs("div",{className:a.wrapper,children:[s.jsxs("div",{className:a.left_div,children:[s.jsxs("div",{className:a.info,children:[s.jsxs("div",{children:[s.jsxs("h4",{children:["Booking Id: ",e==null?void 0:e.bookingId]}),e.autoAssigned&&s.jsx("p",{style:{color:"green"},children:s.jsx("i",{children:"Auto Assigned"})}),s.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"10px"},children:[s.jsx("h4",{children:"Update Status"}),s.jsxs("select",{value:u,onChange:d=>x(()=>d.target.value),className:a.select,name:"status",id:"status",children:[s.jsx("option",{value:"",children:"Select"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]}),s.jsx("button",{onClick:K,className:a.button,style:{marginLeft:"10px"},children:"Update"})]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Payment Status: ",e==null?void 0:e.paymentStatus]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Amount: ",(b=e==null?void 0:e.refundInfo)==null?void 0:b.amount]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Status: ",(T=e==null?void 0:e.refundInfo)==null?void 0:T.status]})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["Date of Booking:"," ",G(new Date(e.bookingDate),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Time of Booking: ",e.bookingTime&&G(new Date(e==null?void 0:e.bookingTime),"hh:mm aa")]}),(!e.sellerId||u==="not-alloted")&&s.jsx("button",{onClick:Z,className:a.button,children:"Assign to partner"}),e.sellerId&&u!=="not-alloted"&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h5",{children:"Assigned to Seller"}),s.jsx("p",{children:e.sellerId.name}),s.jsx("p",{children:e.sellerId.phone})]})]})]}),s.jsx("h5",{className:a.heading,children:"Products"}),s.jsx("div",{className:a.container,children:s.jsxs("div",{className:a.item,children:[s.jsxs("div",{children:[s.jsx("img",{className:a.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:"product"}),s.jsxs("div",{children:[s.jsx("h6",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?"Package":"Product"})]})]}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]})]})})]}),s.jsxs("div",{className:a.right_div,children:[s.jsxs("div",{className:a.right_div_top,children:[s.jsx("h5",{children:"Booking Summary"}),s.jsxs("div",{className:a.heading,children:[s.jsx("p",{children:"Descriptions"}),s.jsx("p",{children:"Amounts"})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Total Amount :"}),s.jsxs("p",{children:["₹",e.orderValue]})]})]}),s.jsxs("div",{className:a.right_div_bottom,children:[s.jsx("h5",{children:"Customer Details"}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Customer Name :"}),s.jsx("p",{children:(q=e==null?void 0:e.userId)==null?void 0:q.name})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Customer Phone :"}),s.jsx("p",{children:(E=e==null?void 0:e.userId)==null?void 0:E.phone})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Customer Address :"}),s.jsx("p",{children:`${e.userAddress.addressLine},${e.userAddress.landmark},${e.userAddress.pincode}`})]})]})]})]}),e&&s.jsxs("div",{className:a.location_container,children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Current Location"}),s.jsx("p",{children:"Service Man is on the way..."}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("h6",{children:"Distance :"}),s.jsx("span",{children:h.distance!==""&&h.distance})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("h6",{children:"Time :"}),s.jsx("span",{children:h.time!==""&&h.time})]})]}),s.jsx("div",{children:s.jsx(qe,{sellerStatus:(P=e.currentLocation)==null?void 0:P.status,bookingStatus:e.status,location:{user:(M=(L=e.userAddress)==null?void 0:L.location)==null?void 0:M.coordinates,seller:(z=e.currentLocation)==null?void 0:z.location}})})]})]})}),H&&s.jsx(xe,{setIsModalOpen:D,serviceId:e.product?e.product.serviceId:e.package.serviceId,bookingId:e._id,getBooking:k})]})};export{Ge as default};
