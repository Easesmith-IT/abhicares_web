import{r as u,h as f,s as v,v as l,q as p}from"./index-CGylhn6U.js";import{v as i}from"./index.esm-BJ_kW8OL.js";import{u as C}from"./useDispatch-Dqrl4_SR.js";const P=()=>{const[g,m]=u.useState(null),[A,h]=u.useState(!1),[y,w]=u.useState(null),c=C();u.useRef(!1);const r=f("userInfo"),e=f("adminInfo"),E=async()=>{var t,n,o;try{const s=await i.get("/shopping/status");((s==null?void 0:s.status)===200||(s==null?void 0:s.status)===201)&&(c(l({isAuthenticated:(t=s==null?void 0:s.data)==null?void 0:t.isAuthenticated})),console.log("User status response:",s),(n=s==null?void 0:s.data)!=null&&n.shouldLogOut?await D():(o=s==null?void 0:s.data)!=null&&o.isAuthenticated||await S())}catch(s){console.error("Error fetching status:",s)}},L=async()=>{var t,n;try{const o=await i.get("/admin/status");((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(console.log("Admin status response:",o),(t=o==null?void 0:o.data)!=null&&t.shouldLogOut?await q():(n=o==null?void 0:o.data)!=null&&n.isAuthenticated||await x())}catch(o){console.error("Error fetching admin status:",o)}},S=async()=>{try{const t=await i.post("/shopping/refresh",{phone:r==null?void 0:r.phone,role:"user"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(c(l({isAuthenticated:!0})),console.log("refresh response:",t))}catch(t){console.error("Error fetching refresh token:",t)}},x=async()=>{try{const t=await i.post("/admin/refresh",{adminId:e==null?void 0:e.id,role:"admin"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(c(p({isAdminAuthenticated:!0})),console.log("refresh response:",t))}catch(t){console.error("Error fetching admin refresh token:",t)}},D=async()=>{try{const t=await i.post("/shopping/logout-all",{phone:r==null?void 0:r.phone,role:"user"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(console.log("Logout response:",t),c(l({isAuthenticated:!1})))}catch(t){console.error("Error logging out:",t)}},q=async()=>{try{const t=await i.post("/admin/logout-all",{adminId:e==null?void 0:e.id,role:"admin"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(console.log("Admin logout response:",t),c(p({isAdminAuthenticated:!1})))}catch(t){console.error("Error logging out admin:",t)}};return{res:g,isLoading:A,fetchData:async(t,n,o={})=>{var s,d;try{h(!0);const a=await i.post(t,n,{...o,withCredentials:!0});console.log("res",a),(a.status===200||a.status===201)&&m(a)}catch(a){w(a),console.log("post api error =>",a),v.error(((d=(s=a.response)==null?void 0:s.data)==null?void 0:d.message)||"An error occurred."),a.response.status===401&&((r==null?void 0:r.role)==="user"&&E(),(e==null?void 0:e.role)==="admin"&&L())}finally{h(!1)}},error:y}};export{P as u};
