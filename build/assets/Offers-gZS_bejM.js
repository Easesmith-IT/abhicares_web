import{r as l,e as $,_ as S,j as e}from"./index-MFgKNwIH.js";import{p as z}from"./index-bQhL1O6I.js";import{W,c as j}from"./Wrapper-DFsBGa0y.js";import{F as B}from"./index.esm-3IZqqgPc.js";import{u as q,a as G}from"./index.esm-cL7qp0JE.js";import{A as Q}from"./add-icon-nobg-CDiYK8IX.js";import{R as H}from"./index.esm-DfQilCDn.js";import{R as J}from"./index-C1e8gEWq.js";/* empty css                   */import{u as K}from"./useAuthorization-CroFzkCu.js";import{u as X}from"./usePatchApiReq-BNycIAdp.js";import{u as Y}from"./usePostApiReq-BPpWmR_n.js";import{D as Z}from"./DeleteModal-BSO39mJX.js";import{L as R}from"./Loader-CO7lNbH5.js";import{u as ee}from"./useDeleteApiReq-CP7Pmsb6.js";import{P as se}from"./react-bootstrap-pagination-control.esm-DkA0QwAF.js";import{f as te}from"./index-BuE1W04I.js";import"./logo -C1Nz5jdc.js";import"./useDispatch-CwGLudnh.js";import"./iconBase-CdfoCUfg.js";const ae="_container_14vyw_1",ne="_city_14vyw_17",ie="_d_flex_14vyw_39",ce="_p_14vyw_51",le="_city_right_14vyw_61",N={container:ae,city:ne,d_flex:ie,p:ce,city_right:le},oe="_wrapper_89j9y_1",re="_modal_89j9y_27",de="_heading_container_89j9y_47",pe="_form_89j9y_59",ue="_input_container_89j9y_73",he="_input_89j9y_73",xe="_button_wrapper_89j9y_105",me="_button_89j9y_105",ge="_categories_89j9y_131",i={wrapper:oe,modal:re,heading_container:de,form:pe,input_container:ue,input:he,button_wrapper:xe,button:me,categories:ge},ye=o=>{const s=/\s/.test(o),D=[...o].every(c=>c===c.toUpperCase());return!!(!s&&D)};function je(o){return o.toUpperCase().replace(/\s+/g,"")}const k=({setIsModalOpen:o,offer:s="",getAllOffers:D})=>{const{res:c,fetchData:M,isLoading:A}=Y(),{res:r,fetchData:w,isLoading:b}=q();K();const[_,v]=l.useState((s==null?void 0:s.description)||""),[u,C]=l.useState((s==null?void 0:s.categoryType)||[]);l.useState(!1);const[a,P]=l.useState({name:(s==null?void 0:s.name)||"",offPercentage:(s==null?void 0:s.offPercentage)||"",noOfTimesPerUser:(s==null?void 0:s.noOfTimesPerUser)||1,status:(s==null?void 0:s.status)||!0,type:(s==null?void 0:s.discountType)||"",upTo:(s==null?void 0:s.maxDiscount)||"",offerValue:(s==null?void 0:s.fixedCouponValue)||"",categoryType:u,expiryDate:(s==null?void 0:s.expiryDate)||""}),[g,U]=l.useState([]),h=n=>{let{name:p,value:d}=n.target;p==="name"&&(d=je(d)),P({...a,[p]:d})},T=async()=>{w("/admin/get-all-category")};l.useEffect(()=>{T()},[]),l.useEffect(()=>{var n;((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&U((n=r==null?void 0:r.data)==null?void 0:n.data)},[r]),$(),console.log("selectedItems",u),console.log("offerInfo",a);const f=n=>{const{value:p,checked:d}=n.target;C(d?y=>[...y,p]:y=>y.filter(O=>O!==p))},{res:x,fetchData:m}=X(),E=async n=>{n.preventDefault();const{name:p,offPercentage:d,type:y,offerValue:O,upTo:V,noOfTimesPerUser:t,categoryType:F}=a,I=!p||!expiryDate||!y||!t||u.length===0||(y==="percentage"?!d||!V:!O),L=!_;if(console.log("isDescriptionMissing",L),console.log("isOfferMissing",I),console.log("isOfferMissing || isDescriptionMissing",I||L),I||L){S.error("All fields are required");return}if(!ye(a.name)){S.error("Please enter valid coupon code");return}s?await m("/admin/update-coupon",{...a,description:_,maxDiscount:a.type==="fixed"?"":a.upTo,discountType:a.type,couponFixedValue:a.type==="fixed"?a.offerValue:"",categoryType:u,offPercentage:a.type==="fixed"?"":a.offPercentage,id:s._id}):M("/admin/create-coupon",{...a,description:_,maxDiscount:a.type==="fixed"?"":a.upTo,discountType:a.type,couponFixedValue:a.type==="fixed"?a.offerValue:"",categoryType:u,offPercentage:a.type==="fixed"?"":a.offPercentage})};return l.useEffect(()=>{((x==null?void 0:x.status)===200||(x==null?void 0:x.status)===201)&&(console.log("updateOfferRes",x),S.success("Offer updated successfully"),D(),o(!1))},[x]),l.useEffect(()=>{((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&(S.success("Offer added successfully"),D(),o(!1))},[c]),e.jsx("div",{className:i.wrapper,children:e.jsxs("div",{className:i.modal,children:[e.jsxs("div",{className:i.heading_container,children:[e.jsxs("h4",{children:[s?"Update":"Add"," Offer"]}),e.jsx("div",{className:i.d_flex,children:e.jsx(H,{onClick:()=>o(!1),cursor:"pointer",size:26})})]}),e.jsxs("form",{onSubmit:E,className:i.form,children:[e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"name",children:"Coupon Code (in block letters and without space)"}),e.jsx("input",{className:i.input,onChange:h,value:a.name,type:"text",name:"name",id:"name"})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"categoryType",children:"Category"}),e.jsxs("div",{className:i.categories,children:[g.length>0&&!b&&(g==null?void 0:g.map(n=>e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{style:{width:"20px",height:"20px"},type:"checkbox",value:n==null?void 0:n._id,id:n==null?void 0:n._id,name:n==null?void 0:n._id,checked:u.some(p=>p===(n==null?void 0:n._id)),onChange:f}),e.jsx("label",{htmlFor:n==null?void 0:n._id,children:n==null?void 0:n.name})]}))),g.length===0&&b&&e.jsx("p",{children:"Loading..."}),g.length===0&&!b&&e.jsx("p",{children:"No Categories found"})]})]}),!s&&e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"type",children:"Coupon Type"}),e.jsxs("select",{className:i.input,onChange:h,value:a.type,name:"type",id:"type",children:[e.jsx("option",{value:"",children:"Select Coupon Type"}),e.jsx("option",{value:"percentage",children:"Percentage"}),e.jsx("option",{value:"fixed",children:"Fixed"})]})]}),a.type==="percentage"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"offPercentage",children:"Offer Percentage"}),e.jsx("input",{className:i.input,onChange:h,value:a.offPercentage,type:"number",name:"offPercentage",id:"offPercentage"})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"upTo",children:"Up To"}),e.jsx("input",{className:i.input,onChange:h,value:a.upTo,type:"number",name:"upTo",id:"upTo"})]})]}),a.type==="fixed"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"offerValue",children:"Offer Value"}),e.jsx("input",{className:i.input,onChange:h,value:a.offerValue,type:"number",name:"offerValue",id:"offerValue"})]})}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"noOfTimesPerUser",children:"No of Times Per User"}),e.jsx("input",{className:i.input,onChange:h,value:a.noOfTimesPerUser,type:"number",name:"noOfTimesPerUser",id:"noOfTimesPerUser"})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"expiryDate",children:"Expiry Date"}),e.jsx("input",{className:i.input,onChange:h,value:a.expiryDate,type:"date",name:"expiryDate",id:"expiryDate"})]}),s&&e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{className:i.input,onChange:h,value:a.status,name:"status",id:"status",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx(J,{theme:"snow",value:_,onChange:v})]}),e.jsx("div",{className:i.button_wrapper,children:e.jsx("button",{className:i.button,children:A?"Loading...":s?"Update":"Add"})})]})]})})},ke=()=>{const{res:o,fetchData:s,isLoading:D}=ee(),{res:c,fetchData:M,isLoading:A}=q(),[r,w]=l.useState(!1),[b,_]=l.useState(!1),[v,u]=l.useState(!1),[C,a]=l.useState({}),[P,g]=l.useState([]),[U,h]=l.useState(1),[T,f]=l.useState(1),x=async t=>{f(t)},[m,E]=l.useState([]),[n,p]=l.useState("all");l.useEffect(()=>{const t=P.filter(F=>F.status===n);E(n==="all"?P:t)},[n,P]),console.log("filteredCoupons",m);const d=async()=>{M(`/admin/get-coupons?page=${T}`)};l.useEffect(()=>{d()},[T]),l.useEffect(()=>{var t,F;((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&(console.log("getCouponsRes",c),h((F=(t=c==null?void 0:c.data)==null?void 0:t.pagination)==null?void 0:F.totalPages),g(c==null?void 0:c.data.data))},[c]);const y=t=>{a(t),_(!v)},O=t=>{a(t),u(!v)},V=async()=>{s(`/admin/delete-coupon/${C}`)};return l.useEffect(()=>{((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(S.success("Offer deleted successfully"),d(),u(!v))},[o]),e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs("div",{className:j["report-container"],children:[e.jsxs("div",{className:j["report-header"],children:[e.jsx("h1",{className:j["recent-Articles"],children:"Offers"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsxs("select",{className:j.input,onChange:t=>p(t.target.value),value:n,children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx("button",{onClick:()=>w(!0),className:j.services_add_btn,children:e.jsx("img",{src:Q,alt:"add"})})]})]}),A&&e.jsx(R,{}),e.jsxs("div",{className:N.container,children:[!A&&(m==null?void 0:m.length)===0&&e.jsx("p",{children:"No offers found"}),m==null?void 0:m.map(t=>e.jsxs("div",{className:N.city,children:[e.jsxs("div",{className:N.city_left,children:[e.jsx("h5",{children:t.name}),e.jsxs("div",{className:N.d_flex,children:[(t==null?void 0:t.discountType)==="fixed"?e.jsxs("p",{children:["â‚¹",t.couponFixedValue]}):e.jsxs("p",{children:[t.offPercentage,"%"]}),e.jsx("p",{className:`${j.status} ${t.status==="active"?j.active:j.inactive}`,children:t.status})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Type:"})," ",t==null?void 0:t.discountType]}),e.jsxs("p",{children:[e.jsx("b",{children:"Expiry Date:"})," ",(t==null?void 0:t.expiryDate)&&te(new Date(t==null?void 0:t.expiryDate),"dd-MM-yyyy")]}),e.jsx("p",{className:N.p,children:z(t.description)})]}),e.jsxs("div",{className:N.city_right,children:[e.jsx(B,{onClick:()=>y(t),cursor:"pointer",size:20}),e.jsx(G,{onClick:()=>O(t._id),cursor:"pointer",size:22,color:"red"})]})]},t._id))]}),e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(se,{changePage:x,limit:10,page:T,total:U+"0"})})]})}),r&&e.jsx(k,{setIsModalOpen:w,getAllOffers:d}),b&&e.jsx(k,{setIsModalOpen:_,getAllOffers:d,offer:C}),v&&e.jsx(Z,{handleDelete:V,setState:u})]})};export{ke as default};
