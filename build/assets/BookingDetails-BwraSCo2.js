import{h as L,r,_ as M,j as s,n as P,u as B,e as R}from"./index-B-IXA8Ie.js";import{I as F}from"./InvoiceModal-zgyv9n98.js";import{u as z}from"./usePostApiReq-BqGvxZz6.js";import{W as V}from"./WebsiteWrapper-ANLKjAv_.js";import{A as U}from"./AddReviewModal-OIUdjyjx.js";import{A as W,u as Y}from"./index.esm-BbyRK8SJ.js";import{f as S}from"./index--LFhlb37.js";import"./index.esm-Cs3NBBGY.js";import"./iconBase-3hUsnpgH.js";import"./jspdf-html2canvas.min-DgPDKMHS.js";import"./index-BzzzayLF.js";import"./useDispatch-C5OFXrAN.js";import"./rolling-white-BBE_8u84.js";import"./Button-BCsCTVJR.js";import"./index.esm-B8E9HluU.js";import"./usePatchApiReq-CFyoLoKy.js";const G="_booking_details_1dnwf_1",Q="_booking_details_left_1dnwf_23",H="_booking_details_right_1dnwf_31",J="_order_details_1dnwf_39",K="_d_flex_1dnwf_39",X="_delivery_details_1dnwf_51",Z="_booking_details_right_top_1dnwf_53",ss="_h4_1dnwf_71",es="_buttons_container_1dnwf_97",os="_button_1dnwf_97",ns="_red_1dnwf_129",as="_progress_1dnwf_159",ts="_status_container_1dnwf_201",cs="_product_contaner_1dnwf_211",ds="_product_1dnwf_211",rs="_img_1dnwf_245",ls="_info_1dnwf_255",is="_p_1dnwf_159",_s="_link_1dnwf_291",ps="_modal_wrapper_1dnwf_327",us="_modal_1dnwf_327",fs="_button_wrapper_1dnwf_371",hs="_yes_1dnwf_399",gs="_no_1dnwf_409",a={booking_details:G,booking_details_left:Q,booking_details_right:H,order_details:J,d_flex:K,delivery_details:X,booking_details_right_top:Z,h4:ss,buttons_container:es,button:os,red:ns,progress:as,status_container:ts,product_contaner:cs,product:ds,img:rs,info:ls,p:is,link:_s,modal_wrapper:ps,modal:us,button_wrapper:fs,yes:hs,no:gs},xs="_modal_overlay_9z2w0_1",bs="_modal_open_9z2w0_21",js="_modal_close_9z2w0_33",ks="_modal_wrapper_9z2w0_41",ms="_modal_9z2w0_1",vs="_p_9z2w0_99",ws="_mt_9z2w0_111",Ns="_rating_container_9z2w0_119",ys="_button_9z2w0_141",Is="_input_box_9z2w0_165",Ts="_input_9z2w0_165",d={modal_overlay:xs,modal_open:bs,modal_close:js,modal_wrapper:ks,modal:ms,p:vs,mt:ws,rating_container:Ns,button:ys,input_box:Is,input:Ts},Ds=({isAddTicketModalOpen:e,setIsAddTicketModalOpen:p,booking:_,item:o})=>{var x,T,k,D,u,C,b,m,v,j;const{res:l,fetchData:f,isLoading:n}=z(),h=L("userInfo"),N=h==null?void 0:h.id;console.log("booking",_);const[i,y]=r.useState({issue:"",description:"",userId:N,sellerId:((x=_==null?void 0:_.bookingId)==null?void 0:x.sellerId)||"",raisedBy:"customer",bookingId:((T=o==null?void 0:o.bookingId)==null?void 0:T._id)||"",serviceType:o!=null&&o.product?(D=(k=o==null?void 0:o.product)==null?void 0:k.serviceId)==null?void 0:D.categoryId:((C=(u=o==null?void 0:o.package)==null?void 0:u.serviceId)==null?void 0:C.categoryId)||"",ticketType:"Booking",serviceId:o!=null&&o.product?(m=(b=o==null?void 0:o.product)==null?void 0:b.serviceId)==null?void 0:m._id:((j=(v=o==null?void 0:o.package)==null?void 0:v.serviceId)==null?void 0:j._id)||"",date:S(new Date,"dd/MM/yyyy")});console.log("ticketInfo",i);const g=c=>{const{name:w,value:O}=c.target;y({...i,[w]:O})},I=async()=>{if(!i.issue||!i.description){M.error("All fields are required");return}f("/shopping/raise-ticket",i)};return r.useEffect(()=>{((l==null?void 0:l.status)===200||(l==null?void 0:l.status)===201)&&(p(!1),M.success("Ticket raised successfully"))},[l]),s.jsx("div",{className:`${d.modal_overlay} ${e?d.modal_open:d.modal_close}`,children:s.jsxs("div",{className:d.modal_wrapper,children:[s.jsx("button",{onClick:()=>p(!1),className:d.modal_close,children:s.jsx(W,{size:20})}),s.jsxs("div",{className:d.modal,children:[s.jsx("p",{className:d.p,children:"Raised Ticket"}),s.jsxs("div",{className:d.mt,children:[s.jsx("label",{htmlFor:"description",children:"Description"}),s.jsx("div",{className:d.input_box,children:s.jsx("input",{className:d.input,onChange:g,value:i.description,type:"text",name:"description",id:"description",placeholder:"Enter your description"})})]}),s.jsxs("div",{className:d.mt,children:[s.jsx("label",{htmlFor:"issue",children:"Issue"}),s.jsx("div",{className:d.input_box,children:s.jsx("input",{className:d.input,onChange:g,value:i.issue,type:"text",name:"issue",id:"issue",placeholder:"Enter the issue"})})]}),s.jsx("button",{onClick:I,className:d.button,children:n?"Loading...":" Proceed"})]})]})})},Cs=({item:e,booking:p})=>{var n;const[_,o]=r.useState(!1),[l,f]=r.useState(!1);return console.log("singleBooking",p),console.log("item",e),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:a.product,children:[s.jsxs("div",{children:[s.jsx("img",{className:a.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:""}),s.jsxs("small",{children:["Type:",e.package?"Package":"Product"]})]}),s.jsxs("div",{className:a.info,children:[s.jsx("h5",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?e.package.bookingDate:e.product.bookingDate}),s.jsx("p",{children:e.package?e.package.bookingTime:e.product.bookingTime}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]}),s.jsxs("div",{style:{display:"flex",gap:"20px",flexDirection:"column"},children:[s.jsx("button",{onClick:()=>o(!0),className:a.button,children:"Add Review"}),s.jsx("button",{onClick:()=>f(!0),className:a.link,children:"Issue with order?"})]})]})]}),_&&s.jsx(U,{isReviewModalOpen:_,setIsReviewModalOpen:o,isBooking:!0,bookingId:(n=e==null?void 0:e.bookingId)==null?void 0:n._id,serviceId:e.package?e.package._id:e.product._id,serviceType:e.package?"package":"product",getAllReviewsOfUser:()=>{}}),l&&s.jsx(Ds,{isAddTicketModalOpen:l,setIsAddTicketModalOpen:f,booking:p,item:e})]})},Ys=()=>{var j;const{res:e,fetchData:p,isLoading:_}=z(),{res:o,fetchData:l,isLoading:f}=Y(),{state:n}=P();B();const h=R();console.log("state",n);const[N,i]=r.useState({}),[y,g]=r.useState(!1),[I,x]=r.useState(!1),[T,k]=r.useState(0),[D,u]=r.useState(0),[C,b]=r.useState(0),m=async()=>{l(`/shopping/get-product-invoice/${n._id}`)};r.useEffect(()=>{var c;((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(console.log("getProductInvoiceRes",o),i((c=o==null?void 0:o.data)==null?void 0:c.data))},[o]);const v=async()=>{p(`/shopping/change-order-status/${n._id}`,{status:"Cancelled"})};return r.useEffect(()=>{((e==null?void 0:e.status)===200||(e==null?void 0:e.status)===201)&&(M.success("Your order cancelled successfully"),h("/my_bookings"))},[e]),r.useEffect(()=>{m();let c=0;for(const t of n.items)t!=null&&t.product?c=c+Number(t.quantity*t.product.offerPrice):t!=null&&t.package&&(c=c+Number(t.quantity*t.package.offerPrice));const w=Number(c)*18/100;k(w),u(()=>c);const{discountType:O,couponFixedValue:$,offPercentage:E,maxDiscount:A}=n.couponId||{};if(n.couponId)if(O==="fixed")b($),u(t=>t-Number($));else{let t=Math.ceil(c*(Number(E)/100));t=t>A?A:t,console.log("offerTotal",t),b(t),u(q=>q-Number(t))}},[n.orderValue,n.couponId]),s.jsx(V,{children:s.jsxs("section",{className:a.booking_details,children:[s.jsxs("div",{className:a.booking_details_left,children:[s.jsxs("div",{className:a.order_details,children:[s.jsx("h4",{className:a.h4,children:"Order Details"}),s.jsxs("div",{className:a.d_flex,children:[s.jsxs("div",{children:[s.jsxs("p",{children:["Order Date: ",S(new Date(n.createdAt),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Order ID: ",n.orderId]}),s.jsxs("p",{children:["Order Status: ",n.status]})]}),s.jsxs("div",{className:a.buttons_container,children:[s.jsx("button",{onClick:()=>g(!0),className:a.button,children:"View Invoice"}),n.status!=="Cancelled"&&s.jsx("button",{onClick:()=>x(!0),className:`${a.button} ${a.red}`,children:"Cancel Order"})]})]})]}),s.jsx("div",{className:a.delivery_details,children:s.jsx("div",{className:a.product_contaner,children:(j=n==null?void 0:n.items)==null?void 0:j.map((c,w)=>s.jsx(Cs,{item:c,booking:n}))})})]}),s.jsx("div",{className:a.booking_details_right,children:s.jsxs("div",{className:a.booking_details_right_top,children:[s.jsx("h4",{className:a.h4,children:"Order Total"}),s.jsxs("div",{className:a.d_flex,children:[s.jsxs("div",{children:[s.jsx("p",{children:"Subtotal: "}),s.jsx("p",{children:"Tax and other charges: "}),n.discount>0&&s.jsx("p",{children:"Discount: "}),n.referalDiscount&&s.jsx("p",{children:"Referal Discount: "}),s.jsx("p",{children:s.jsx("b",{children:"Total: "})})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["₹",n.itemTotal]}),s.jsxs("p",{children:[" + ₹",n.tax]}),n.discount>0&&s.jsxs("p",{children:[" - ₹",n.discount]}),n.referalDiscount&&s.jsxs("p",{children:[" - ₹",n.referalDiscount]}),s.jsx("p",{children:s.jsxs("b",{children:["₹",n.orderValue]})})]})]})]})}),y&&s.jsx(F,{state:n,invoice:N,setIsInvoiceModalOpen:g}),I&&s.jsx("div",{className:a.modal_wrapper,children:s.jsxs("div",{className:a.modal,children:[s.jsx("p",{children:"Are you sure to cancel ?"}),s.jsxs("div",{className:a.button_wrapper,children:[s.jsx("button",{onClick:v,className:`${a.button} ${a.yes}`,children:"Yes"}),s.jsx("button",{onClick:()=>x(!1),className:`${a.button} ${a.no}`,children:"No"})]})]})})]})})};export{Ys as default};
