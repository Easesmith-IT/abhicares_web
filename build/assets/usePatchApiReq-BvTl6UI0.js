import{r as i,h as d,s as f,v as p,q as g}from"./index-I-QjRnx0.js";import{v as n}from"./index.esm-C3Z8P0YS.js";import{u as q}from"./useDispatch-PMR2IWSw.js";const C=()=>{const[m,A]=i.useState(null),[y,u]=i.useState(!1),c=q();i.useRef(!1);const o=d("userInfo"),a=d("adminInfo"),w=async()=>{var t,r;try{const s=await n.get("/shopping/status");((s==null?void 0:s.status)===200||(s==null?void 0:s.status)===201)&&(console.log("User status response:",s),(t=s==null?void 0:s.data)!=null&&t.shouldLogOut?await x():(r=s==null?void 0:s.data)!=null&&r.isAuthenticated||await L())}catch(s){console.error("Error fetching status:",s)}},E=async()=>{var t,r;try{const s=await n.get("/admin/status");((s==null?void 0:s.status)===200||(s==null?void 0:s.status)===201)&&(console.log("Admin status response:",s),(t=s==null?void 0:s.data)!=null&&t.shouldLogOut?await D():(r=s==null?void 0:s.data)!=null&&r.isAuthenticated||await S())}catch(s){console.error("Error fetching admin status:",s)}},L=async()=>{try{const t=await n.post("/shopping/refresh",{phone:o==null?void 0:o.phone,role:"user"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(c(p({isAuthenticated:!0})),console.log("refresh response:",t))}catch(t){console.error("Error fetching refresh token:",t)}},S=async()=>{try{const t=await n.post("/admin/refresh",{adminId:a==null?void 0:a.id,role:"admin"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(c(g({isAdminAuthenticated:!0})),console.log("refresh response:",t))}catch(t){console.error("Error fetching admin refresh token:",t)}},x=async()=>{try{const t=await n.post("/shopping/logout-all",{phone:o==null?void 0:o.phone,role:"user"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(console.log("Logout response:",t),c(p({isAuthenticated:!1})))}catch(t){console.error("Error logging out:",t)}},D=async()=>{try{const t=await n.post("/admin/logout-all",{adminId:a==null?void 0:a.id,role:"admin"});((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(console.log("Admin logout response:",t),c(g({isAdminAuthenticated:!1})))}catch(t){console.error("Error logging out admin:",t)}};return{res:m,isLoading:y,fetchData:async(t,r,s={})=>{var h,l;try{u(!0);const e=await n.patch(t,r,s);console.log("res",e),(e.status===200||e.status===201)&&(f.success(e.data.message),A(e))}catch(e){console.log("patch api error =>",e),f.error(((l=(h=e.response)==null?void 0:h.data)==null?void 0:l.message)||"An error occurred."),e.response.status===401&&((o==null?void 0:o.role)==="user"&&w(),(a==null?void 0:a.role)==="admin"&&E())}finally{u(!1)}}}};export{C as u};
