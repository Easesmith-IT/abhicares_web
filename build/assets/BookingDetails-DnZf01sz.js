import{h as M,r as l,j as s,_ as y,f as O,o as R,p as A,e as S}from"./index-DcmPn4CU.js";import{I as z}from"./InvoiceModal-Bg_ui2IQ.js";import{W as P}from"./WebsiteWrapper-CBbZpn7g.js";import{A as B}from"./AddReviewModal-DOFTHaLl.js";import{A as q}from"./LogoutModal-Di1XuGXS.js";import{f as $}from"./index-C8LMNyAy.js";import"./index.esm-7S8pM4Fp.js";import"./iconBase-BJ2zDtiE.js";import"./jspdf-html2canvas.min-Ds1XyINr.js";import"./index-CyNR1zuL.js";import"./rolling-white-BBE_8u84.js";import"./Button-D4N1S2yu.js";import"./index.esm-COsu3BVV.js";const E="_booking_details_1dnwf_1",F="_booking_details_left_1dnwf_23",V="_booking_details_right_1dnwf_31",U="_order_details_1dnwf_39",W="_d_flex_1dnwf_39",Y="_delivery_details_1dnwf_51",L="_booking_details_right_top_1dnwf_53",Q="_h4_1dnwf_71",G="_buttons_container_1dnwf_97",H="_button_1dnwf_97",J="_red_1dnwf_129",K="_progress_1dnwf_159",X="_status_container_1dnwf_201",Z="_product_contaner_1dnwf_211",ss="_product_1dnwf_211",es="_img_1dnwf_245",os="_info_1dnwf_255",as="_p_1dnwf_159",ns="_link_1dnwf_291",ts="_modal_wrapper_1dnwf_327",cs="_modal_1dnwf_327",rs="_button_wrapper_1dnwf_371",ds="_yes_1dnwf_399",ls="_no_1dnwf_409",o={booking_details:E,booking_details_left:F,booking_details_right:V,order_details:U,d_flex:W,delivery_details:Y,booking_details_right_top:L,h4:Q,buttons_container:G,button:H,red:J,progress:K,status_container:X,product_contaner:Z,product:ss,img:es,info:os,p:as,link:ns,modal_wrapper:ts,modal:cs,button_wrapper:rs,yes:ds,no:ls},is="_modal_overlay_9z2w0_1",_s="_modal_open_9z2w0_21",ps="_modal_close_9z2w0_33",us="_modal_wrapper_9z2w0_41",hs="_modal_9z2w0_1",gs="_p_9z2w0_99",xs="_mt_9z2w0_111",fs="_rating_container_9z2w0_119",bs="_button_9z2w0_141",js="_input_box_9z2w0_165",ks="_input_9z2w0_165",c={modal_overlay:is,modal_open:_s,modal_close:ps,modal_wrapper:us,modal:hs,p:gs,mt:xs,rating_container:fs,button:bs,input_box:js,input:ks},ms=({isAddTicketModalOpen:e,setIsAddTicketModalOpen:p,booking:i,item:a})=>{var T,g,C,f,m,w,b,n,j,v;const _=M("userInfo"),u=_==null?void 0:_.id;console.log("booking",i);const[r,k]=l.useState({issue:"",description:"",userId:u,sellerId:((T=i==null?void 0:i.bookingId)==null?void 0:T.sellerId)||"",raisedBy:"customer",bookingId:((g=a==null?void 0:a.bookingId)==null?void 0:g._id)||"",serviceType:a!=null&&a.product?(f=(C=a==null?void 0:a.product)==null?void 0:C.serviceId)==null?void 0:f.categoryId:((w=(m=a==null?void 0:a.package)==null?void 0:m.serviceId)==null?void 0:w.categoryId)||"",ticketType:"Booking",serviceId:a!=null&&a.product?(n=(b=a==null?void 0:a.product)==null?void 0:b.serviceId)==null?void 0:n._id:((v=(j=a==null?void 0:a.package)==null?void 0:j.serviceId)==null?void 0:v._id)||"",date:$(new Date,"dd/MM/yyyy")});console.log("ticketInfo",r);const N=h=>{const{name:x,value:d}=h.target;k({...r,[x]:d})},I=async()=>{var h,x;if(!r.issue||!r.description){y.error("All fields are required");return}try{const{data:d}=await O.post("https://abhicares.com/api/shopping/raise-ticket",r,{withCredentials:!0});p(!1),y.success("Ticket raised successfully"),console.log(d)}catch(d){y.error((x=(h=d==null?void 0:d.response)==null?void 0:h.data)==null?void 0:x.message),console.log(d)}};return s.jsx("div",{className:`${c.modal_overlay} ${e?c.modal_open:c.modal_close}`,children:s.jsxs("div",{className:c.modal_wrapper,children:[s.jsx("button",{onClick:()=>p(!1),className:c.modal_close,children:s.jsx(q,{size:20})}),s.jsxs("div",{className:c.modal,children:[s.jsx("p",{className:c.p,children:"Raised Ticket"}),s.jsxs("div",{className:c.mt,children:[s.jsx("label",{htmlFor:"description",children:"Description"}),s.jsx("div",{className:c.input_box,children:s.jsx("input",{className:c.input,onChange:N,value:r.description,type:"text",name:"description",id:"description",placeholder:"Enter your description"})})]}),s.jsxs("div",{className:c.mt,children:[s.jsx("label",{htmlFor:"issue",children:"Issue"}),s.jsx("div",{className:c.input_box,children:s.jsx("input",{className:c.input,onChange:N,value:r.issue,type:"text",name:"issue",id:"issue",placeholder:"Enter the issue"})})]}),s.jsx("button",{onClick:I,className:c.button,children:"Proceed"})]})]})})},ws=({item:e,booking:p})=>{var r;const[i,a]=l.useState(!1),[_,u]=l.useState(!1);return console.log("singleBooking",p),console.log("item",e),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:o.product,children:[s.jsxs("div",{children:[s.jsx("img",{className:o.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:""}),s.jsxs("small",{children:["Type:",e.package?"Package":"Product"]})]}),s.jsxs("div",{className:o.info,children:[s.jsx("h5",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?e.package.bookingDate:e.product.bookingDate}),s.jsx("p",{children:e.package?e.package.bookingTime:e.product.bookingTime}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]}),s.jsxs("div",{style:{display:"flex",gap:"20px",flexDirection:"column"},children:[s.jsx("button",{onClick:()=>a(!0),className:o.button,children:"Add Review"}),s.jsx("button",{onClick:()=>u(!0),className:o.link,children:"Issue with order?"})]})]})]}),i&&s.jsx(B,{isReviewModalOpen:i,setIsReviewModalOpen:a,isBooking:!0,bookingId:(r=e==null?void 0:e.bookingId)==null?void 0:r._id,serviceId:e.package?e.package._id:e.product._id,serviceType:e.package?"package":"product",getAllReviewsOfUser:()=>{}}),_&&s.jsx(ms,{isAddTicketModalOpen:_,setIsAddTicketModalOpen:u,booking:p,item:e})]})},zs=()=>{var b;const{state:e}=R();A();const p=S();console.log("state",e);const[i,a]=l.useState({}),[_,u]=l.useState(!1),[r,k]=l.useState(!1),[N,I]=l.useState(0),[T,g]=l.useState(0),[C,f]=l.useState(0),m=async()=>{try{const{data:n}=await O.get(`https://abhicares.com/api/shopping/get-product-invoice/${e._id}`,{withCredentials:!0});a(n.data)}catch(n){console.log(n)}},w=async()=>{try{const{data:n}=await O.post(`https://abhicares.com/api/shopping/change-order-status/${e._id}`,{status:"Cancelled"},{withCredentials:!0});y.success("Your order cancelled successfully"),p("/my_bookings")}catch(n){console.log(n)}};return l.useEffect(()=>{m();let n=0;for(const t of e.items)t!=null&&t.product?n=n+Number(t.quantity*t.product.offerPrice):t!=null&&t.package&&(n=n+Number(t.quantity*t.package.offerPrice));const j=Number(n)*18/100;I(j),g(()=>n);const{discountType:v,couponFixedValue:h,offPercentage:x,maxDiscount:d}=e.couponId||{};if(e.couponId)if(v==="fixed")f(h),g(t=>t-Number(h));else{let t=Math.ceil(n*(Number(x)/100));t=t>d?d:t,console.log("offerTotal",t),f(t),g(D=>D-Number(t))}},[e.orderValue,e.couponId]),s.jsx(P,{children:s.jsxs("section",{className:o.booking_details,children:[s.jsxs("div",{className:o.booking_details_left,children:[s.jsxs("div",{className:o.order_details,children:[s.jsx("h4",{className:o.h4,children:"Order Details"}),s.jsxs("div",{className:o.d_flex,children:[s.jsxs("div",{children:[s.jsxs("p",{children:["Order Date: ",$(new Date(e.createdAt),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Order ID: ",e.orderId]}),s.jsxs("p",{children:["Order Status: ",e.status]})]}),s.jsxs("div",{className:o.buttons_container,children:[s.jsx("button",{onClick:()=>u(!0),className:o.button,children:"View Invoice"}),e.status!=="Cancelled"&&s.jsx("button",{onClick:()=>k(!0),className:`${o.button} ${o.red}`,children:"Cancel Order"})]})]})]}),s.jsx("div",{className:o.delivery_details,children:s.jsx("div",{className:o.product_contaner,children:(b=e==null?void 0:e.items)==null?void 0:b.map((n,j)=>s.jsx(ws,{item:n,booking:e}))})})]}),s.jsx("div",{className:o.booking_details_right,children:s.jsxs("div",{className:o.booking_details_right_top,children:[s.jsx("h4",{className:o.h4,children:"Order Total"}),s.jsxs("div",{className:o.d_flex,children:[s.jsxs("div",{children:[s.jsx("p",{children:"Subtotal: "}),s.jsx("p",{children:"Tax(18%): "}),e.discount>0&&s.jsx("p",{children:"Discount: "}),e.referalDiscount&&s.jsx("p",{children:"Referal Discount: "}),s.jsx("p",{children:s.jsx("b",{children:"Total: "})})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["₹",e.itemTotal]}),s.jsxs("p",{children:[" + ₹",e.tax]}),e.discount>0&&s.jsxs("p",{children:[" - ₹",e.discount]}),e.referalDiscount&&s.jsxs("p",{children:[" - ₹",e.referalDiscount]}),s.jsx("p",{children:s.jsxs("b",{children:["₹",e.orderValue]})})]})]})]})}),_&&s.jsx(z,{state:e,invoice:i,setIsInvoiceModalOpen:u}),r&&s.jsx("div",{className:o.modal_wrapper,children:s.jsxs("div",{className:o.modal,children:[s.jsx("p",{children:"Are you sure to cancel ?"}),s.jsxs("div",{className:o.button_wrapper,children:[s.jsx("button",{onClick:w,className:`${o.button} ${o.yes}`,children:"Yes"}),s.jsx("button",{onClick:()=>k(!1),className:`${o.button} ${o.no}`,children:"No"})]})]})})]})})};export{zs as default};
