import{r as i,e as k,j as e,f as P,_ as w}from"./index-C00j65eE.js";import{W as $,c as j}from"./Wrapper-Bui_DUEg.js";import{p as L}from"./index-Wjobe2wE.js";import{F as z}from"./index.esm-DCKmuxgF.js";import{a as E}from"./LogoutModal-BFEBZfWM.js";import{A as W}from"./add-icon-nobg-CDiYK8IX.js";import{L as q}from"./Loader-Bg91KXBw.js";import{D as B}from"./DeleteModal-iZuDhOqx.js";import{R as Q}from"./index.esm-dmdmgyGU.js";import{R}from"./index-Dck4Nyuq.js";/* empty css                   */import{u as M}from"./useAuthorization-BQLez6m4.js";import"./logo -C1Nz5jdc.js";import"./iconBase-DBedV832.js";const G="_container_14vyw_1",H="_city_14vyw_17",J="_d_flex_14vyw_39",K="_p_14vyw_51",X="_city_right_14vyw_61",b={container:G,city:H,d_flex:J,p:K,city_right:X},Y="_wrapper_89j9y_1",Z="_modal_89j9y_27",ee="_heading_container_89j9y_47",se="_form_89j9y_59",te="_input_container_89j9y_73",ae="_input_89j9y_73",ne="_button_wrapper_89j9y_105",ce="_button_89j9y_105",ie="_categories_89j9y_131",c={wrapper:Y,modal:Z,heading_container:ee,form:se,input_container:te,input:ae,button_wrapper:ne,button:ce,categories:ie},le=l=>{const t=/\s/.test(l),_=[...l].every(x=>x===x.toUpperCase());return!!(!t&&_)};function oe(l){return l.toUpperCase().replace(/\s+/g,"")}const D=({setIsModalOpen:l,offer:t="",getAllOffers:_})=>{const{checkAuthorization:x}=M(),[d,v]=i.useState((t==null?void 0:t.description)||""),[p,T]=i.useState((t==null?void 0:t.categoryType)||[]),[y,f]=i.useState(!1),[a,F]=i.useState({name:(t==null?void 0:t.name)||"",offPercentage:(t==null?void 0:t.offPercentage)||"",noOfTimesPerUser:(t==null?void 0:t.noOfTimesPerUser)||1,status:(t==null?void 0:t.status)||!0,type:(t==null?void 0:t.discountType)||"",upTo:(t==null?void 0:t.maxDiscount)||"",offerValue:(t==null?void 0:t.fixedCouponValue)||"",categoryType:p}),[m,o]=i.useState([]),u=n=>{let{name:r,value:h}=n.target;r==="name"&&(h=oe(h)),F({...a,[r]:h})},C=async()=>{f(!0);try{const{data:n}=await P.get("https://abhicares.com/api/admin/get-all-category",{withCredentials:!0});o(n.data),f(!1),console.log("allCategories",n)}catch(n){console.log(n),f(!1)}};i.useEffect(()=>{C()},[]),k(),console.log("selectedItems",p),console.log("offerInfo",a);const S=n=>{const{value:r,checked:h}=n.target;T(h?s=>[...s,r]:s=>s.filter(O=>O!==r))},N=async n=>{n.preventDefault();const{name:r,offPercentage:h,type:s,offerValue:O,upTo:V,noOfTimesPerUser:I,categoryType:re}=a,A=!r||!s||!I||p.length===0||(s==="percentage"?!h||!V:!O),U=!d;if(console.log("isDescriptionMissing",U),console.log("isOfferMissing",A),console.log("isOfferMissing || isDescriptionMissing",A||U),A||U){w.error("All fields are required");return}if(t)try{const{data:g}=await P.patch("https://abhicares.com/api/admin/update-coupon",{...a,description:d,maxDiscount:a.type==="fixed"?"":a.upTo,discountType:a.type,couponFixedValue:a.type==="fixed"?a.offerValue:"",categoryType:p,offPercentage:a.type==="fixed"?"":a.offPercentage,id:t._id},{withCredentials:!0});w.success("Offer updated successfully"),_(),l(!1)}catch(g){console.log(g),l(!1),x(g)}else try{if(!le(a.name)){w.error("Please enter valid coupon code");return}const{data:g}=await P.post("https://abhicares.com/api/admin/create-coupon",{...a,description:d,maxDiscount:a.type==="fixed"?"":a.upTo,discountType:a.type,couponFixedValue:a.type==="fixed"?a.offerValue:"",categoryType:p,offPercentage:a.type==="fixed"?"":a.offPercentage},{withCredentials:!0});console.log("add offer res",g),w.success("Offer added successfully"),_(),l(!1)}catch(g){l(!1),x(g),console.log(g)}};return e.jsx("div",{className:c.wrapper,children:e.jsxs("div",{className:c.modal,children:[e.jsxs("div",{className:c.heading_container,children:[e.jsxs("h4",{children:[t?"Update":"Add"," Offer"]}),e.jsx("div",{className:c.d_flex,children:e.jsx(Q,{onClick:()=>l(!1),cursor:"pointer",size:26})})]}),e.jsxs("form",{onSubmit:N,className:c.form,children:[e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"name",children:"Coupon Code (in block letters and without space)"}),e.jsx("input",{className:c.input,onChange:u,value:a.name,type:"text",name:"name",id:"name"})]}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"categoryType",children:"Category"}),e.jsxs("div",{className:c.categories,children:[m.length>0&&!y&&(m==null?void 0:m.map(n=>e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{style:{width:"20px",height:"20px"},type:"checkbox",value:n==null?void 0:n._id,id:n==null?void 0:n._id,name:n==null?void 0:n._id,checked:p.some(r=>r===(n==null?void 0:n._id)),onChange:S}),e.jsx("label",{htmlFor:n==null?void 0:n._id,children:n==null?void 0:n.name})]}))),m.length===0&&y&&e.jsx("p",{children:"Loading..."}),m.length===0&&!y&&e.jsx("p",{children:"No Categories found"})]})]}),!t&&e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"type",children:"Coupon Type"}),e.jsxs("select",{className:c.input,onChange:u,value:a.type,name:"type",id:"type",children:[e.jsx("option",{value:"",children:"Select Coupon Type"}),e.jsx("option",{value:"percentage",children:"Percentage"}),e.jsx("option",{value:"fixed",children:"Fixed"})]})]}),a.type==="percentage"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"offPercentage",children:"Offer Percentage"}),e.jsx("input",{className:c.input,onChange:u,value:a.offPercentage,type:"number",name:"offPercentage",id:"offPercentage"})]}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"upTo",children:"Up To"}),e.jsx("input",{className:c.input,onChange:u,value:a.upTo,type:"number",name:"upTo",id:"upTo"})]})]}),a.type==="fixed"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"offerValue",children:"Offer Value"}),e.jsx("input",{className:c.input,onChange:u,value:a.offerValue,type:"number",name:"offerValue",id:"offerValue"})]})}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"noOfTimesPerUser",children:"No of Times Per User"}),e.jsx("input",{className:c.input,onChange:u,value:a.noOfTimesPerUser,type:"number",name:"noOfTimesPerUser",id:"noOfTimesPerUser"})]}),t&&e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{className:c.input,onChange:u,value:a.status,name:"status",id:"status",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx(R,{theme:"snow",value:d,onChange:v})]}),e.jsx("div",{className:c.button_wrapper,children:e.jsx("button",{className:c.button,children:t?"Update":"Add"})})]})]})})},Te=()=>{const[l,t]=i.useState(!1),[_,x]=i.useState(!1),[d,v]=i.useState(!1),[p,T]=i.useState({}),[y,f]=i.useState([]),[a,F]=i.useState(!0),{checkAuthorization:m}=M(),[o,u]=i.useState([]),[C,S]=i.useState("all");i.useEffect(()=>{const s=y.filter(O=>O.status===C);u(C==="all"?y:s)},[C,y]),console.log("filteredCoupons",o);const N=async()=>{try{const{data:s}=await P.get("https://abhicares.com/api/admin/get-coupons",{withCredentials:!0});console.log(s),f(s.data)}catch(s){console.log(s)}finally{F(!1)}};i.useEffect(()=>{N()},[]);const n=s=>{T(s),x(!d)},r=s=>{T(s),v(!d)},h=async()=>{try{const{data:s}=await P.delete(`https://abhicares.com/api/admin/delete-coupon/${p}`,{withCredentials:!0});w.success("Offer deleted successfully"),N(),v(!d)}catch(s){console.log(s),v(!1),m(s)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsxs("div",{className:j["report-container"],children:[e.jsxs("div",{className:j["report-header"],children:[e.jsx("h1",{className:j["recent-Articles"],children:"Offers"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsxs("select",{className:j.input,onChange:s=>S(s.target.value),value:C,children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx("button",{onClick:()=>t(!0),className:j.services_add_btn,children:e.jsx("img",{src:W,alt:"add"})})]})]}),e.jsxs("div",{className:b.container,children:[!a&&(o==null?void 0:o.length)===0&&e.jsx("p",{children:"No offers found"}),a&&(o==null?void 0:o.length)===0&&e.jsx(q,{}),o==null?void 0:o.map(s=>e.jsxs("div",{className:b.city,children:[e.jsxs("div",{className:b.city_left,children:[e.jsx("h5",{children:s.name}),e.jsxs("div",{className:b.d_flex,children:[(s==null?void 0:s.discountType)==="fixed"?e.jsxs("p",{children:["â‚¹",s.couponFixedValue]}):e.jsxs("p",{children:[s.offPercentage,"%"]}),e.jsx("p",{className:`${j.status} ${s.status==="active"?j.active:j.inactive}`,children:s.status})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Type:"})," ",s==null?void 0:s.discountType]}),e.jsx("p",{className:b.p,children:L(s.description)})]}),e.jsxs("div",{className:b.city_right,children:[e.jsx(z,{onClick:()=>n(s),cursor:"pointer",size:20}),e.jsx(E,{onClick:()=>r(s._id),cursor:"pointer",size:22,color:"red"})]})]},s._id))]})]})}),l&&e.jsx(D,{setIsModalOpen:t,getAllOffers:N}),_&&e.jsx(D,{setIsModalOpen:x,getAllOffers:N,offer:p}),d&&e.jsx(B,{handleDelete:h,setState:v})]})};export{Te as default};
