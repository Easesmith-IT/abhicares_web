import{r as c,u as y,j as e,e as x,_ as b}from"./index-DpM_z6IC.js";import{W as T,c as l}from"./Wrapper-D8NCHknB.js";import{R as S}from"./index.esm-BqNeVfbB.js";/* empty css                   */import{f as N}from"./index-hn_tsJ_x.js";import"./logo -C1Nz5jdc.js";import"./LogoutModal-rCWBQ8ER.js";import"./iconBase-BW6_ZAh3.js";const w="_wrapper_h75sc_1",C="_modal_h75sc_27",F="_heading_container_h75sc_47",E="_form_h75sc_59",D="_input_container_h75sc_73",$="_input_h75sc_73",P="_button_wrapper_h75sc_105",A="_button_h75sc_105",L="_image_h75sc_131",i={wrapper:w,modal:C,heading_container:F,form:E,input_container:D,input:$,button_wrapper:P,button:A,image:L},M=({setIsModalOpen:o,getNotifications:h})=>{const[t,d]=c.useState({image:"",imagePrev:"",title:"",desc:"",timingType:"",time:"",date:"",appType:"all"}),u=f=>{const s=f.target.files[0];console.log(s);const m=new FileReader;m.readAsDataURL(s),m.addEventListener("load",function(){console.log(this.result),d({...t,image:s,imagePrev:this.result})})},n=f=>{const{name:s,value:m}=f.target;d({...t,[s]:m})};y();const[g,r]=c.useState(!1);console.log("notificationInfo",t);const p=async f=>{try{if(f.preventDefault(),!t.title||!t.desc||!t.appType){console.log("error");return}const s=new FormData;s.append("title",t.title),s.append("description",t.desc),s.append("date",t.date),s.append("time",t.time),s.append("image",t.image),s.append("appType",t.appType),r(!0);const{data:m}=await x.post("https://abhicares.com/api/admin/send-notification",s);r(!1),console.log(m),b.success("Notification sent successfully"),h(),o(!1)}catch(s){r(!1),console.log(s)}};return e.jsx("div",{className:i.wrapper,children:e.jsxs("div",{className:i.modal,children:[e.jsxs("div",{className:i.heading_container,children:[e.jsx("h4",{children:"Send Notification"}),e.jsx("div",{className:i.d_flex,children:e.jsx(S,{onClick:()=>o(!1),cursor:"pointer",size:26})})]}),e.jsxs("form",{onSubmit:p,className:i.form,children:[e.jsxs("div",{className:i.imageWrapper,children:[t.imagePrev&&e.jsx("img",{className:i.image,src:t.imagePrev,alt:""}),e.jsx("div",{children:e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:u})})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"title",children:"Title"}),e.jsx("input",{className:i.input,onChange:n,value:t.title,type:"text",name:"title",id:"title"})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"desc",children:"Description"}),e.jsx("textarea",{className:i.input,onChange:n,value:t.desc,name:"desc",id:"desc"})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"appType",children:"App Type"}),e.jsxs("select",{className:i.input,onChange:n,value:t.appType,name:"appType",id:"appType",children:[e.jsx("option",{value:"mainApp",children:"Main App"}),e.jsx("option",{value:"partnerApp",children:"Partner App"}),e.jsx("option",{value:"all",children:"all"})]})]}),e.jsxs("div",{className:i.input_container,children:[e.jsx("label",{htmlFor:"timing",children:"Timing"}),e.jsxs("select",{className:i.input,onChange:n,value:t.timingType,name:"timingType",id:"timingType",children:[e.jsx("option",{value:"now",children:"Now"}),e.jsx("option",{value:"select",children:"Choose Time"})]}),t.timingType==="select"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsx("input",{className:i.input,onChange:n,value:t.date,type:"date",name:"date",id:"date"}),e.jsx("input",{className:i.input,onChange:n,value:t.time,type:"time",name:"time",id:"time"})]})]}),e.jsx("div",{className:i.button_wrapper,children:e.jsx("button",{className:i.button,children:g?"Sending...":"Send"})})]})]})})},R="_notification_rfkr1_1",I={notification:R},O=({notification:o})=>{const{date:h,time:t}=o.scheduleTiming||{},d=new Date(`2024-01-01T${t}`),u=N(d,"hh:mm:ss a");return console.log(u),e.jsxs("div",{className:I.notification,children:[e.jsx("h4",{children:o==null?void 0:o.title}),e.jsx("p",{children:o==null?void 0:o.description}),e.jsxs("p",{children:[e.jsx("b",{children:"Scheduled time: "})," ",h&&N(new Date(h),"dd/MM/yyyy")," ",u]})]})},J=()=>{const[o,h]=c.useState(!1),[t,d]=c.useState([]),[u,n]=c.useState(!1),[g,r]=c.useState(null),[p,f]=c.useState(""),[s,m]=c.useState(""),j=async()=>{try{n(!0),r(null);const{data:a}=await x.get("https://abhicares.com/api/admin/get-all-notifications");d(a==null?void 0:a.data)}catch(a){r("Failed to fetch notifications. Please try again later."),console.error("Error fetching notifications:",a)}finally{n(!1)}};console.log("searchTerm",p);const _=async()=>{console.log("in search function");try{n(!0),r(null);const{data:a}=await x.get(`https://abhicares.com/api/admin/search-notifications?title=${p}`);console.log("response",a),d(a==null?void 0:a.data)}catch(a){r("Failed to fetch notifications. Please try again later."),console.error("Error fetching notifications:",a)}finally{n(!1)}},v=async()=>{try{n(!0),r(null);const{data:a}=await x.get(`https://abhicares.com/api/admin/filter-notifications?date=${s}`);console.log("filterNotifications response",a),d(a==null?void 0:a.data)}catch(a){r("Failed to fetch notifications. Please try again later."),console.error("Error fetching notifications:",a)}finally{n(!1)}};return c.useEffect(()=>{!p&&j()},[]),c.useEffect(()=>{p&&_()},[p]),c.useEffect(()=>{s&&v()},[s]),e.jsxs(e.Fragment,{children:[e.jsx(T,{children:e.jsxs("div",{className:l["report-container"],children:[e.jsxs("div",{className:l["report-header"],children:[e.jsx("h1",{className:l["recent-Articles"],children:"Notifications"}),e.jsx("input",{onChange:a=>f(a.target.value),className:l.input,type:"text",placeholder:"Search notification",value:p}),e.jsxs("div",{className:l.filterSend,children:[e.jsx("span",{children:"Filter by date"}),e.jsx("input",{onChange:a=>m(a.target.value),className:l.input,style:{width:"200px"},type:"date",value:s})]}),e.jsx("button",{onClick:()=>h(!0),className:l.sendNotificationBtn,disabled:u,children:"Send Notification"})]}),e.jsxs("div",{className:l["report-body"],children:[g&&e.jsx("div",{className:"error-message",children:g}),u?e.jsx("div",{children:"Loading notifications..."}):e.jsx("div",{className:l.notifications,children:t.length>0?t.map(a=>e.jsx(O,{notification:a},a._id)):e.jsx("div",{children:"No notifications found"})})]})]})}),o&&e.jsx(M,{setIsModalOpen:h,getNotifications:j})]})};export{J as default};
