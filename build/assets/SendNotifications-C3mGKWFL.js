import{r as c,e as y,j as e,f as x,_ as b}from"./index-C00j65eE.js";import{W as S,c as l}from"./Wrapper-Bui_DUEg.js";import{R as w}from"./index.esm-dmdmgyGU.js";/* empty css                   */import{f as _}from"./index-CwLm7xHs.js";import"./logo -C1Nz5jdc.js";import"./LogoutModal-BFEBZfWM.js";import"./iconBase-DBedV832.js";const C="_wrapper_h75sc_1",T="_modal_h75sc_27",F="_heading_container_h75sc_47",E="_form_h75sc_59",D="_input_container_h75sc_73",$="_input_h75sc_73",P="_button_wrapper_h75sc_105",L="_button_h75sc_105",R="_image_h75sc_131",a={wrapper:C,modal:T,heading_container:F,form:E,input_container:D,input:$,button_wrapper:P,button:L,image:R},I=({setIsModalOpen:n,getNotifications:h})=>{const[s,d]=c.useState({image:"",imagePrev:"",title:"",desc:"",timingType:"",time:"",date:""}),f=u=>{const i=u.target.files[0];console.log(i);const p=new FileReader;p.readAsDataURL(i),p.addEventListener("load",function(){console.log(this.result),d({...s,image:i,imagePrev:this.result})})},o=u=>{const{name:i,value:p}=u.target;d({...s,[i]:p})};y();const[g,r]=c.useState(!1);console.log("notificationInfo",s);const m=async u=>{try{if(u.preventDefault(),!s.title||!s.desc){console.log("error");return}const i=new FormData;i.append("title",s.title),i.append("description",s.desc),i.append("date",s.date),i.append("time",s.time),i.append("image",s.image),r(!0);const{data:p}=await x.post("https://abhicares.com/api/admin/send-notification",i);r(!1),console.log(p),b.success("Notification sent successfully"),h(),n(!1)}catch(i){r(!1),console.log(i)}};return e.jsx("div",{className:a.wrapper,children:e.jsxs("div",{className:a.modal,children:[e.jsxs("div",{className:a.heading_container,children:[e.jsx("h4",{children:"Send Notification"}),e.jsx("div",{className:a.d_flex,children:e.jsx(w,{onClick:()=>n(!1),cursor:"pointer",size:26})})]}),e.jsxs("form",{onSubmit:m,className:a.form,children:[e.jsxs("div",{className:a.imageWrapper,children:[s.imagePrev&&e.jsx("img",{className:a.image,src:s.imagePrev,alt:""}),e.jsx("div",{children:e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:f})})]}),e.jsxs("div",{className:a.input_container,children:[e.jsx("label",{htmlFor:"title",children:"Title"}),e.jsx("input",{className:a.input,onChange:o,value:s.title,type:"text",name:"title",id:"title"})]}),e.jsxs("div",{className:a.input_container,children:[e.jsx("label",{htmlFor:"desc",children:"Description"}),e.jsx("textarea",{className:a.input,onChange:o,value:s.desc,name:"desc",id:"desc"})]}),e.jsxs("div",{className:a.input_container,children:[e.jsx("label",{htmlFor:"timing",children:"Timing"}),e.jsxs("select",{className:a.input,onChange:o,value:s.timingType,name:"timingType",id:"timingType",children:[e.jsx("option",{value:"now",children:"Now"}),e.jsx("option",{value:"select",children:"Choose Time"})]}),s.timingType==="select"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsx("input",{className:a.input,onChange:o,value:s.date,type:"date",name:"date",id:"date"}),e.jsx("input",{className:a.input,onChange:o,value:s.time,type:"time",name:"time",id:"time"})]})]}),e.jsx("div",{className:a.button_wrapper,children:e.jsx("button",{className:a.button,children:g?"Sending...":"Send"})})]})]})})},M="_notification_rfkr1_1",O={notification:M},k=({notification:n})=>{const{date:h,time:s}=n.scheduleTiming||{},d=new Date(`2024-01-01T${s}`),f=_(d,"hh:mm:ss a");return console.log(f),e.jsxs("div",{className:O.notification,children:[e.jsx("h4",{children:n==null?void 0:n.title}),e.jsx("p",{children:n==null?void 0:n.description}),e.jsxs("p",{children:[e.jsx("b",{children:"Scheduled time: "})," ",h&&_(new Date(h),"dd/MM/yyyy")," ",f]})]})},J=()=>{const[n,h]=c.useState(!1),[s,d]=c.useState([]),[f,o]=c.useState(!1),[g,r]=c.useState(null),[m,u]=c.useState(""),[i,p]=c.useState(""),j=async()=>{try{o(!0),r(null);const{data:t}=await x.get("https://abhicares.com/api/admin/get-all-notifications");d(t==null?void 0:t.data)}catch(t){r("Failed to fetch notifications. Please try again later."),console.error("Error fetching notifications:",t)}finally{o(!1)}};console.log("searchTerm",m);const N=async()=>{console.log("in search function");try{o(!0),r(null);const{data:t}=await x.get(`https://abhicares.com/api/admin/search-notifications?title=${m}`);console.log("response",t),d(t==null?void 0:t.data)}catch(t){r("Failed to fetch notifications. Please try again later."),console.error("Error fetching notifications:",t)}finally{o(!1)}},v=async()=>{try{o(!0),r(null);const{data:t}=await x.get(`https://abhicares.com/api/admin/filter-notifications?date=${i}`);console.log("filterNotifications response",t),d(t==null?void 0:t.data)}catch(t){r("Failed to fetch notifications. Please try again later."),console.error("Error fetching notifications:",t)}finally{o(!1)}};return c.useEffect(()=>{!m&&j()},[]),c.useEffect(()=>{m&&N()},[m]),c.useEffect(()=>{i&&v()},[i]),e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs("div",{className:l["report-container"],children:[e.jsxs("div",{className:l["report-header"],children:[e.jsx("h1",{className:l["recent-Articles"],children:"Notifications"}),e.jsx("input",{onChange:t=>u(t.target.value),className:l.input,type:"text",placeholder:"Search notification",value:m}),e.jsxs("div",{className:l.filterSend,children:[e.jsx("span",{children:"Filter by date"}),e.jsx("input",{onChange:t=>p(t.target.value),className:l.input,style:{width:"200px"},type:"date",value:i})]}),e.jsx("button",{onClick:()=>h(!0),className:l.sendNotificationBtn,disabled:f,children:"Send Notification"})]}),e.jsxs("div",{className:l["report-body"],children:[g&&e.jsx("div",{className:"error-message",children:g}),f?e.jsx("div",{children:"Loading notifications..."}):e.jsx("div",{className:l.notifications,children:s.length>0?s.map(t=>e.jsx(k,{notification:t},t._id)):e.jsx("div",{children:"No notifications found"})})]})]})}),n&&e.jsx(I,{setIsModalOpen:h,getNotifications:j})]})};export{J as default};
