import{r,e as q,_ as z,j as e}from"./index-jh_7jsAh.js";import{u as y,a as O,g as W}from"./index.esm-CbTUZ4YC.js";import{L as G}from"./Loader-DWDw_Ctb.js";import{W as H,c as h}from"./Wrapper-BxFEiEae.js";import{h as p}from"./HelpCenter.module-CDSZ6uwM.js";import{D as J}from"./DeleteModal-D9-MpWwM.js";import{P as K}from"./react-bootstrap-pagination-control.esm-BpD4t2g1.js";import{u as U}from"./useDeleteApiReq-BO4SlYl6.js";import{f as V}from"./index-CnJc0tvj.js";import"./iconBase-CTzivY3m.js";import"./logo -C1Nz5jdc.js";const us=()=>{const{res:u,fetchData:D,isLoading:X}=U(),{res:d,fetchData:b,isLoading:Y}=y(),{res:n,fetchData:S,isLoading:m}=y(),{res:l,fetchData:N,isLoading:Z}=y();r.useState(!1);const[x,j]=r.useState(!1),[I,_]=r.useState(""),[o,g]=r.useState([]),P=q(),[i,B]=r.useState(1),[A,v]=r.useState(0),[a,E]=r.useState({date:"",serviceType:"",raisedBy:"",status:"",searchQuery:""}),[f,L]=r.useState([]);console.log("filter",a);const $=async()=>{b("/admin/get-all-category")};r.useEffect(()=>{$()},[]),r.useEffect(()=>{((d==null?void 0:d.status)===200||(d==null?void 0:d.status)===201)&&(console.log("getCategoriesRes",d),L(d==null?void 0:d.data.data))},[d]);const M=async s=>{B(s)},c=s=>{const{name:t,value:T}=s.target;E({...a,[t]:T})},C=async()=>{S(`/admin/get-all-tickets?page=${i}&ticketId=${a.searchQuery}`)};r.useEffect(()=>{((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(v(n==null?void 0:n.data.totalPages),g(n==null?void 0:n.data.data))},[n]),r.useEffect(()=>{!a.date&&!a.raisedBy&&!a.serviceType&&a.searchQuery&&!a.status?C():Q()},[i,a.date,a.raisedBy,a.serviceType,a.searchQuery,a.status]);const Q=async()=>{N(`/admin/filter-ticket?date=${a.date}&serviceType=${a.serviceType}&raisedBy=${a.raisedBy}&page=${i}`)};r.useEffect(()=>{((l==null?void 0:l.status)===200||(l==null?void 0:l.status)===201)&&(v(l==null?void 0:l.data.totalPages),g(l==null?void 0:l.data.data))},[l]);const F=s=>{_(s),j(!x)},w=async()=>{D(`/admin/delete-ticket?ticketId=${I}`)};return r.useEffect(()=>{((u==null?void 0:u.status)===200||(u==null?void 0:u.status)===201)&&(z.success("Ticket deleted successfully"),C(),j(!x))},[u]),e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs("div",{className:h["report-container"],children:[e.jsxs("div",{className:h["report-header"],children:[e.jsx("h1",{className:h["recent-Articles"],children:"All Tickets"}),e.jsxs("div",{className:h.filter,children:[e.jsx("input",{type:"search",name:"searchQuery",value:a.searchQuery,onChange:c,placeholder:"Search by ticket Id",className:h.filter_input}),e.jsx("input",{type:"date",name:"date",value:a.date,onChange:c,placeholder:"Start Date",className:h.filter_input}),e.jsxs("select",{name:"serviceType",value:a.serviceType,onChange:c,className:h.filter_input,children:[e.jsx("option",{value:"",children:"Select Service Category"}),f==null?void 0:f.map(s=>e.jsx("option",{value:s==null?void 0:s._id,children:s==null?void 0:s.name},s==null?void 0:s._id))]}),e.jsxs("select",{name:"raisedBy",value:a.raisedBy,onChange:c,className:h.filter_input,children:[e.jsx("option",{value:"",children:"Raised by"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"partner",children:"Partner"})]})]})]}),e.jsxs("div",{className:p.container,children:[!m&&(o==null?void 0:o.length)===0&&e.jsx("p",{children:"No tickets found"}),m&&(o==null?void 0:o.length)===0&&e.jsx(G,{}),o==null?void 0:o.map(s=>{var t;return e.jsxs("div",{className:p.helpCenter,children:[e.jsxs("div",{className:p.helpCenter_left,children:[e.jsx("p",{children:s!=null&&s.status?e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",e.jsx("span",{className:(s==null?void 0:s.status)==="in-review"?p.under_review:p.resolved,children:s==null?void 0:s.status})]}):e.jsx("span",{children:"Status unavailable"})}),e.jsxs("p",{children:[e.jsx("b",{children:"Raised by:"})," ",s==null?void 0:s.raisedBy]}),e.jsxs("p",{children:[e.jsx("b",{children:"Concern:"})," ",s==null?void 0:s.description]}),e.jsxs("p",{children:[e.jsx("b",{children:"Issue Date:"})," ",V(new Date(s==null?void 0:s.createdAt),"dd-MM-yyyy")]}),e.jsxs("p",{children:[e.jsx("b",{children:"Raiser ID :"})," ",(s==null?void 0:s.raisedBy)==="customer"?s==null?void 0:s.userId:s==null?void 0:s.sellerId]}),(s==null?void 0:s.bookingId)&&e.jsxs("p",{children:[e.jsx("b",{children:"Booking ID :"})," ",(t=s==null?void 0:s.bookingId)==null?void 0:t.bookingId]}),e.jsxs("p",{children:[e.jsx("b",{children:"Service ID :"})," ",s==null?void 0:s.serviceId]}),e.jsxs("p",{children:[e.jsx("b",{children:"Ticket type :"})," ",s==null?void 0:s.ticketType]}),e.jsxs("p",{children:[e.jsx("b",{children:"Ticket Id :"})," ",s==null?void 0:s.ticketId]})]}),e.jsxs("div",{className:p.helpCenter_right,children:[e.jsx(O,{onClick:()=>F(s._id),cursor:"pointer",size:22,color:"red"}),e.jsx(W,{onClick:()=>P(`/admin/help-center/tickets/${s._id}`),cursor:"pointer",size:22})]})]},s==null?void 0:s._id)})]}),e.jsx("div",{children:e.jsx(K,{changePage:M,limit:10,page:i,total:A+"0"})})]})}),x&&e.jsx(J,{handleDelete:w,setState:j})]})};export{us as default};
