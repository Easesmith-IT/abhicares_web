import{r as l,_ as M,j as e}from"./index-CGylhn6U.js";import{W as k,c as d}from"./Wrapper-CdkfNuyb.js";import{R as A}from"./index.esm-C03Euai7.js";/* empty css                   */import{u as I}from"./usePostApiReq-C7INsCRY.js";import{f as b}from"./index-DMx44xLR.js";import{u as C}from"./index.esm-BJ_kW8OL.js";import{P as O}from"./react-bootstrap-pagination-control.esm-Bp3mw4s9.js";import"./logo -C1Nz5jdc.js";import"./useDispatch-Dqrl4_SR.js";import"./iconBase-BOE9-_A9.js";const W="_wrapper_h75sc_1",q="_modal_h75sc_27",z="_heading_container_h75sc_47",B="_form_h75sc_59",G="_input_container_h75sc_73",H="_input_h75sc_73",U="_button_wrapper_h75sc_105",J="_button_h75sc_105",K="_image_h75sc_131",s={wrapper:W,modal:q,heading_container:z,form:B,input_container:G,input:H,button_wrapper:U,button:J,image:K},Q=({setIsModalOpen:t,getNotifications:x})=>{const{res:r,fetchData:n,isLoading:f}=I(),[a,i]=l.useState({image:"",imagePrev:"",title:"",desc:"",timingType:"",time:"",date:"",appType:"all"}),y=m=>{const c=m.target.files[0];console.log(c);const u=new FileReader;u.readAsDataURL(c),u.addEventListener("load",function(){console.log(this.result),i({...a,image:c,imagePrev:this.result})})},p=m=>{const{name:c,value:u}=m.target;i({...a,[c]:u})};console.log("notificationInfo",a);const N=async m=>{if(m.preventDefault(),!a.title||!a.desc||!a.appType){console.log("error");return}const c=new FormData;c.append("title",a.title),c.append("description",a.desc),c.append("date",a.date),c.append("time",a.time),c.append("image",a.image),c.append("appType",a.appType),n("/admin/send-notification",c)};return l.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&(M.success("Notification sent successfully"),x(),t(!1))},[r]),e.jsx("div",{className:s.wrapper,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.heading_container,children:[e.jsx("h4",{children:"Send Notification"}),e.jsx("div",{className:s.d_flex,children:e.jsx(A,{onClick:()=>t(!1),cursor:"pointer",size:26})})]}),e.jsxs("form",{onSubmit:N,className:s.form,children:[e.jsxs("div",{className:s.imageWrapper,children:[a.imagePrev&&e.jsx("img",{className:s.image,src:a.imagePrev,alt:""}),e.jsx("div",{children:e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:y})})]}),e.jsxs("div",{className:s.input_container,children:[e.jsx("label",{htmlFor:"title",children:"Title"}),e.jsx("input",{className:s.input,onChange:p,value:a.title,type:"text",name:"title",id:"title"})]}),e.jsxs("div",{className:s.input_container,children:[e.jsx("label",{htmlFor:"desc",children:"Description"}),e.jsx("textarea",{className:s.input,onChange:p,value:a.desc,name:"desc",id:"desc"})]}),e.jsxs("div",{className:s.input_container,children:[e.jsx("label",{htmlFor:"appType",children:"App Type"}),e.jsxs("select",{className:s.input,onChange:p,value:a.appType,name:"appType",id:"appType",children:[e.jsx("option",{value:"mainApp",children:"Main App"}),e.jsx("option",{value:"partnerApp",children:"Partner App"}),e.jsx("option",{value:"all",children:"all"})]})]}),e.jsxs("div",{className:s.input_container,children:[e.jsx("label",{htmlFor:"timing",children:"Timing"}),e.jsxs("select",{className:s.input,onChange:p,value:a.timingType,name:"timingType",id:"timingType",children:[e.jsx("option",{value:"now",children:"Now"}),e.jsx("option",{value:"select",children:"Choose Time"})]}),a.timingType==="select"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsx("input",{className:s.input,onChange:p,value:a.date,type:"date",name:"date",id:"date"}),e.jsx("input",{className:s.input,onChange:p,value:a.time,type:"time",name:"time",id:"time"})]})]}),e.jsx("div",{className:s.button_wrapper,children:e.jsx("button",{className:s.button,children:f?"Sending...":"Send"})})]})]})})},V="_notification_rfkr1_1",X={notification:V},Y=({notification:t})=>{const{date:x,time:r}=t.scheduleTiming||{},n=new Date(`2024-01-01T${r}`),f=b(n,"hh:mm:ss a");return console.log(f),e.jsxs("div",{className:X.notification,children:[e.jsx("h4",{children:t==null?void 0:t.title}),e.jsx("p",{children:t==null?void 0:t.description}),e.jsxs("p",{children:[e.jsx("b",{children:"Scheduled time: "})," ",x&&b(new Date(x),"dd/MM/yyyy")," ",f]})]})},re=()=>{const{res:t,fetchData:x,isLoading:r}=C(),{res:n,fetchData:f,isLoading:a}=C(),{res:i,fetchData:y,isLoading:p}=C(),[N,m]=l.useState(!1),[c,u]=l.useState([]);l.useState(null);const[j,w]=l.useState(""),[_,P]=l.useState(""),[D,T]=l.useState(1),[v,L]=l.useState(1),E=async o=>{L(o)},S=async()=>{x(`/admin/get-all-notifications?page=${v}`)};l.useEffect(()=>{var o,h,g;((t==null?void 0:t.status)===200||(t==null?void 0:t.status)===201)&&(console.log("getAllNotificationsRes",t),u((o=t==null?void 0:t.data)==null?void 0:o.data),T((g=(h=t==null?void 0:t.data)==null?void 0:h.pagination)==null?void 0:g.totalPages))},[t]),console.log("searchTerm",j);const F=async()=>{f(`/admin/search-notifications?title=${j}`)};l.useEffect(()=>{var o,h,g;((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(u((o=n==null?void 0:n.data)==null?void 0:o.data),console.log("searchNotificationRes",n),T((g=(h=n==null?void 0:n.data)==null?void 0:h.pagination)==null?void 0:g.totalPages))},[n]);const $=async()=>{y(`/admin/filter-notifications?date=${_}&page=${v}`)};return l.useEffect(()=>{var o,h,g;((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&(console.log("filterNotificationRes",i),T((h=(o=i==null?void 0:i.data)==null?void 0:o.pagination)==null?void 0:h.totalPages),u((g=i==null?void 0:i.data)==null?void 0:g.data))},[i]),l.useEffect(()=>{!j&&S(),j&&F()},[j,v]),l.useEffect(()=>{_&&$(),!_&&S()},[_,v]),e.jsxs(e.Fragment,{children:[e.jsx(k,{children:e.jsxs("div",{className:d["report-container"],children:[e.jsxs("div",{className:d["report-header"],children:[e.jsx("h1",{className:d["recent-Articles"],children:"Notifications"}),e.jsx("input",{onChange:o=>w(o.target.value),className:d.input,type:"text",placeholder:"Search notification",value:j}),e.jsxs("div",{className:d.filterSend,children:[e.jsx("span",{children:"Filter by date"}),e.jsx("input",{onChange:o=>P(o.target.value),className:d.input,style:{width:"200px"},type:"date",value:_})]}),e.jsx("button",{onClick:()=>m(!0),className:d.sendNotificationBtn,children:"Send Notification"})]}),e.jsx("div",{className:d["report-body"],children:r||a||p?e.jsx("div",{children:"Loading notifications..."}):e.jsx("div",{className:d.notifications,children:c.length>0?c.map(o=>e.jsx(Y,{notification:o},o._id)):e.jsx("div",{children:"No notifications found"})})}),e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(O,{changePage:E,limit:10,page:v,total:D+"0"})})]})}),N&&e.jsx(Q,{setIsModalOpen:m,getNotifications:S})]})};export{re as default};
