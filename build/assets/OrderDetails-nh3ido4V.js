import{n as B,r as c,e as F,u as G,_ as Q,j as e}from"./index-eSIAY8Uv.js";import{W as z}from"./Wrapper-C_MBzJws.js";import{c as u}from"./Shared.module-DD54I-nI.js";import{u as H}from"./usePostApiReq-CCJmJfW3.js";import{u as J}from"./index.esm-DOqJpdRb.js";import{f}from"./index-BFFTBMbo.js";import"./logo -C1Nz5jdc.js";import"./useDispatch-BjeBiUzI.js";import"./iconBase-BPNpYAOT.js";const K="_wrapper_xu49t_1",R="_left_div_xu49t_19",X="_select_xu49t_33",Y="_info_xu49t_45",Z="_heading_xu49t_55",ss="_container_xu49t_67",es="_item_xu49t_91",ns="_img_xu49t_115",ds="_right_div_xu49t_125",os="_right_div_top_xu49t_133",rs="_right_div_bottom_xu49t_135",is="_d_flex_xu49t_157",d={wrapper:K,left_div:R,select:X,info:Y,heading:Z,container:ss,item:es,img:ns,right_div:ds,right_div_top:os,right_div_bottom:rs,d_flex:is},vs=()=>{var b,N,y,k,D,T,I,C,P,S,$,A;const{res:l,fetchData:w,isLoading:cs}=H(),{res:r,fetchData:O,isLoading:ls}=J(),{state:t}=B(),[L,q]=c.useState(0),[as,_]=c.useState(0),[us,m]=c.useState(0),j=F(),[s,E]=c.useState(t||""),[M,g]=c.useState(t==null?void 0:t.status),{id:U}=G();console.log("stateData",t);const v=async()=>{O(`/admin/get-order-details?orderId=${U}`)};c.useEffect(()=>{v()},[s==null?void 0:s._id]),c.useEffect(()=>{var n,i,a;((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&(console.log("getOrderRes",r),E((n=r==null?void 0:r.data)==null?void 0:n.data),g((a=(i=r==null?void 0:r.data)==null?void 0:i.data)==null?void 0:a.status))},[r]);const V=async n=>{const i=n.target.value;g(()=>i),w(`/admin/change-order-status/${s==null?void 0:s._id}`,{status:i})};return c.useEffect(()=>{((l==null?void 0:l.status)===200||(l==null?void 0:l.status)===201)&&(Q.success("Order status changed successfully"),v())},[l]),c.useEffect(()=>{if(s!=null&&s.items&&(s==null?void 0:s.items.length)>0){let n=0;for(const o of s.items)o!=null&&o.product?n=n+Number(o.quantity*o.product.offerPrice):n=n+Number(o.quantity*o.package.offerPrice);_(()=>n);const i=Number(n)*18/100;q(i);const{discountType:a,couponFixedValue:h,offPercentage:p,maxDiscount:x}=(s==null?void 0:s.couponId)||{};if(s!=null&&s.couponId)if(a==="fixed")m(h),_(o=>o-Number(h));else{let o=Math.ceil(n*(Number(p)/100));o=o>x?x:o,console.log("offerTotal",o),m(o),_(W=>W-Number(o))}}},[s==null?void 0:s.orderValue,s==null?void 0:s.couponId,s,s==null?void 0:s.items,L,j]),e.jsx(z,{children:e.jsxs("div",{className:d.wrapper,children:[e.jsxs("div",{className:d.left_div,children:[e.jsxs("div",{className:d.info,children:[e.jsxs("div",{children:[e.jsxs("h4",{children:["Order Id: ",s==null?void 0:s.orderId]}),e.jsx("h5",{children:"Update Status"}),e.jsxs("select",{onChange:V,value:M,className:d.select,name:"status",id:"status",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"OutOfDelivery",children:"OutOfDelivery"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:["Date of Order:"," ",(s==null?void 0:s.createdAt)&&f(new Date(s==null?void 0:s.createdAt),"dd-MM-yyyy")]}),e.jsxs("p",{children:["Time of Order:"," ",(s==null?void 0:s.createdAt)&&f(new Date(s==null?void 0:s.createdAt),"hh:mm aa")]}),e.jsxs("p",{children:["Payment Type: ",s==null?void 0:s.paymentType]}),e.jsxs("p",{children:["No of Left Bookings: ",s==null?void 0:s.No_of_left_bookings]}),e.jsxs("p",{children:["Refund Amount: ",(b=s==null?void 0:s.refundInfo)==null?void 0:b.amount]}),e.jsxs("p",{children:["Refund Status: ",(N=s==null?void 0:s.refundInfo)==null?void 0:N.status]})]})]}),e.jsxs("p",{style:{marginTop:"20px"},children:["Admin Comment: ",s==null?void 0:s.adminComment]}),e.jsx("h5",{className:d.heading,children:"Products"}),e.jsx("div",{className:d.container,children:(y=s==null?void 0:s.items)==null?void 0:y.map((n,i)=>{var a,h,p,x;return e.jsxs("div",{onClick:()=>j(`/admin/bookings/${n==null?void 0:n.bookingId}`),style:{cursor:"pointer"},className:d.item,children:[e.jsxs("div",{children:[e.jsx("img",{className:d.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${n.package?n.package.imageUrl[0]:n.product.imageUrl[0]}`,alt:"product"}),e.jsxs("div",{children:[e.jsx("h6",{children:n.package?n.package.name:n.product.name}),e.jsx("p",{children:n.package?"Package":"Product"})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0"},children:[e.jsxs("p",{children:[e.jsx("span",{children:"Delivery Date: "}),n.bookingId.bookingDate&&f(new Date(n.bookingId.bookingDate),"dd-MM-yyyy")]}),e.jsxs("p",{children:[e.jsx("span",{children:"Delivery Time: "}),n.bookingId.bookingTime&&f(new Date(n.bookingId.bookingTime),"hh:mm aa")]})]}),e.jsx("p",{children:e.jsx("span",{className:`${u["t-op-nextlvl"]} ${u.status} ${((a=n==null?void 0:n.bookingId)==null?void 0:a.status)==="cancelled"?u.Cancelled:((h=n==null?void 0:n.bookingId)==null?void 0:h.status)==="completed"?u.Completed:((p=n==null?void 0:n.bookingId)==null?void 0:p.status)==="alloted"?u.alloted:u.OutOfDelivery}`,children:(x=n==null?void 0:n.bookingId)==null?void 0:x.status})}),e.jsxs("p",{children:["Qty: ",n.quantity]}),e.jsxs("p",{children:["₹",Number(n.package?n.package.offerPrice:n.product.offerPrice)*Number(n.quantity)]})]},i)})})]}),e.jsxs("div",{className:d.right_div,children:[e.jsxs("div",{className:d.right_div_top,children:[e.jsx("h5",{children:"Order Summary"}),e.jsxs("div",{className:d.heading,children:[e.jsx("p",{children:"Descriptions"}),e.jsx("p",{children:"Amounts"})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Sub Total :"}),e.jsxs("p",{children:["₹",s==null?void 0:s.itemTotal]})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Tax and other charges :"}),e.jsxs("p",{children:["+ ₹",s==null?void 0:s.tax]})]}),(s==null?void 0:s.discount)>0&&e.jsxs("div",{className:d.d_flex,children:[e.jsxs("p",{children:["Discount ('",(k=s==null?void 0:s.couponId)==null?void 0:k.name,"') :"]}),e.jsxs("p",{children:["- ₹",s==null?void 0:s.discount]})]}),(s==null?void 0:s.referalDiscount)>0&&e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Referal Discount :"}),e.jsxs("p",{children:["- ₹",s==null?void 0:s.referalDiscount]})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Total Amount :"}),e.jsxs("p",{children:["₹",s==null?void 0:s.orderValue]})]})]}),e.jsxs("div",{className:d.right_div_bottom,children:[e.jsx("h5",{children:"Customer Details"}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Customer Name :"}),e.jsx("p",{children:(D=s==null?void 0:s.user)==null?void 0:D.name})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Customer Phone :"}),e.jsx("p",{children:(T=s==null?void 0:s.user)==null?void 0:T.phone})]}),e.jsxs("div",{className:d.d_flex,children:[e.jsx("p",{children:"Customer Address :"}),e.jsx("p",{children:`${(C=(I=s==null?void 0:s.user)==null?void 0:I.address)==null?void 0:C.addressLine},${(S=(P=s==null?void 0:s.user)==null?void 0:P.address)==null?void 0:S.landmark},${(A=($=s==null?void 0:s.user)==null?void 0:$.address)==null?void 0:A.pincode}`})]})]})]})]})})};export{vs as default};
