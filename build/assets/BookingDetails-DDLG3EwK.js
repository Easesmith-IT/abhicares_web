import{r as a,_ as Q,j as s,d as g,u as se,e as te}from"./index-CGylhn6U.js";import{R as ae}from"./index.esm-C03Euai7.js";/* empty css                   */import{u as ne}from"./useAuthorization-C2vLYWOS.js";import{L as re}from"./Loader-D9yVIxxu.js";import{u as Z}from"./usePatchApiReq-CoISmjAR.js";import{u as $}from"./index.esm-BJ_kW8OL.js";import{W as ie}from"./Wrapper-CdkfNuyb.js";import{f as C}from"./index-DMx44xLR.js";import"./iconBase-BOE9-_A9.js";import"./useDispatch-Dqrl4_SR.js";import"./logo -C1Nz5jdc.js";const ce="_wrapper_qlkv1_1",oe="_modal_qlkv1_27",le="_heading_container_qlkv1_47",de="_form_qlkv1_59",he="_input_container_qlkv1_73",ue="_input_qlkv1_73",pe="_button_wrapper_qlkv1_105",me="_button_qlkv1_105",_e="_partner_container_qlkv1_131",xe="_partner_qlkv1_131",fe="_partner_left_qlkv1_165",p={wrapper:ce,modal:oe,heading_container:le,form:de,input_container:he,input:ue,button_wrapper:pe,button:me,partner_container:_e,partner:xe,partner_left:fe},je=({setIsModalOpen:n,serviceId:l="",bookingId:m,getBooking:i})=>{const[c,N]=a.useState([]),{res:r,fetchData:_,isLoading:x}=$();ne();const e=async()=>{_(`/admin/get-seller-list/${l}`)};a.useEffect(()=>{e()},[]),a.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&N(r==null?void 0:r.data.data)},[r]);const{res:o,fetchData:u}=Z(),f=async h=>{await u(`/admin/allot-seller-order/${h}`,{bookingId:m})};return a.useEffect(()=>{((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(console.log("assignPartnerRes",o),Q.success("Order assigned to seller successfully"),i(),n(!1))},[o]),s.jsx("div",{className:p.wrapper,children:s.jsxs("div",{className:p.modal,children:[s.jsxs("div",{className:p.heading_container,children:[s.jsx("h4",{children:"Assigne Partner"}),s.jsx("div",{className:p.d_flex,children:s.jsx(ae,{onClick:()=>n(!1),cursor:"pointer",size:26})})]}),s.jsxs("div",{className:p.partner_container,children:[!x&&c.length===0&&s.jsx("p",{children:"No seller found for selected service."}),x&&c.length===0&&s.jsx(re,{}),c&&c.map(h=>s.jsx("div",{className:p.partner,children:s.jsxs("div",{className:p.partner_left,children:[s.jsxs("p",{children:["Seller Name: ",h.name]}),s.jsxs("p",{children:["Seller Phone: ",h.phone]}),s.jsx("button",{onClick:()=>f(h._id),className:p.button,children:"Assign"})]})}))]})]})})},ve="_wrapper_ohei2_1",ye="_left_div_ohei2_23",ge="_select_ohei2_37",Ne="_info_ohei2_49",Ae="_heading_ohei2_59",we="_button_ohei2_71",Se="_container_ohei2_91",Ce="_item_ohei2_115",$e="_img_ohei2_139",Ie="_right_div_ohei2_149",Te="_right_div_top_ohei2_157",De="_right_div_bottom_ohei2_159",qe="_d_flex_ohei2_181",Ee="_location_container_ohei2_269",Me="_location_container_left_ohei2_297",t={wrapper:ve,left_div:ye,select:ge,info:Ne,heading:Ae,button:we,container:Se,item:Ce,img:$e,right_div:Ie,right_div_top:Te,right_div_bottom:De,d_flex:qe,location_container:Ee,location_container_left:Me},Pe=({google:n,location:l,sellerStatus:m,bookingStatus:i})=>{var T,A,D;const{res:c,fetchData:N,isLoading:r}=$(),[_,x]=a.useState(null),[e,o]=a.useState(!1),u={width:"100%",height:"500px"},f={lat:l.user[0],lng:l.user[1]},h={lat:l.seller[0],lng:l.seller[1]},I=async()=>{const j=`${l.seller[0]},${l.seller[1]}`,v=`${l.user[0]},${l.user[1]}`;N(`/admin/get-the-path-from-source-to-destination?sourceCoordinates=${j}&destinationCoordinates=${v}`)};return a.useEffect(()=>{I()},[]),a.useEffect(()=>{var j,v;((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&x((v=(j=c==null?void 0:c.data.routes[0])==null?void 0:j.overview_polyline)==null?void 0:v.points)},[c]),a.useEffect(()=>{o(!(m==="out-of-delivery"&&i==="started"))},[m,i]),s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsxs(g.Map,{google:n,zoom:14,style:u,initialCenter:f,children:[s.jsx(g.Marker,{position:f,title:"User",icon:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}}),s.jsx(g.Marker,{position:h,title:"Seller",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}),_&&s.jsx(g.Polyline,{path:_&&((D=(A=(T=n==null?void 0:n.maps)==null?void 0:T.geometry)==null?void 0:A.encoding)==null?void 0:D.decodePath(_)),strokeColor:"#4285F4",strokeOpacity:1,strokeWeight:4})]})}),e&&s.jsx("div",{style:{border:"2px solid",position:"absolute",bottom:0,right:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px",zIndex:10},children:"The Seller is not started yet!"})]})},Le=g.GoogleApiWrapper({apiKey:"AIzaSyB_ZhYrt0hw7zB74UYGhh4Wt_IkltFzo-I"})(Pe),Qe=()=>{var P,L,z,B,F,U,V,k;const{res:n,fetchData:l,isLoading:m}=$(),{res:i,fetchData:c,isLoading:N}=$(),{res:r,fetchData:_}=Z(),{id:x}=se(),[e,o]=a.useState(null),[u,f]=a.useState({time:"",distance:""}),[h,I]=a.useState(0),[T,A]=a.useState(0),[D,j]=a.useState(0),v=te(),[y,E]=a.useState((e==null?void 0:e.status)||""),[b,M]=a.useState(!1),q=async()=>{l(`/admin/get-booking-details/${x}`)};a.useEffect(()=>{((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(o(n==null?void 0:n.data.bookingDetails),E(n==null?void 0:n.data.bookingDetails.status))},[n]);const J=async()=>{y!==""&&await _(`/admin/update-seller-order-status/${e._id}`,{status:y})};console.log("booking 123",e);const X=async()=>{try{if(e){const d=`${e.currentLocation.location[0]},${e.currentLocation.location[1]}`,S=`${e.userAddress.location.coordinates[0]},${e.userAddress.location.coordinates[1]}`;c(`/admin/get-the-distance-routes?origins=${d}&destinations=${S}`)}}catch(d){console.log(d)}};a.useEffect(()=>{m||X()},[m]),a.useEffect(()=>{var d,S,W,O,G,Y,H,K;((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&f({distance:(O=(W=(S=(d=i==null?void 0:i.data)==null?void 0:d.rows[0])==null?void 0:S.elements[0])==null?void 0:W.distance)==null?void 0:O.text,time:(K=(H=(Y=(G=i==null?void 0:i.data)==null?void 0:G.rows[0])==null?void 0:Y.elements[0])==null?void 0:H.duration)==null?void 0:K.text})},[i]),a.useEffect(()=>{q()},[]),a.useEffect(()=>{var d;I((e==null?void 0:e.orderValue)*18/100),A(Number(h)+Number(e==null?void 0:e.orderValue)),e!=null&&e.couponId&&j((e==null?void 0:e.orderValue)*((d=e==null?void 0:e.couponId)==null?void 0:d.offPercentage)/100)},[e==null?void 0:e.orderValue,e==null?void 0:e.couponId,h,v]);const R=()=>{M(!0)};let w=(e==null?void 0:e.bookingTime)&&new Date(e==null?void 0:e.bookingTime),ee=w&&(w==null?void 0:w.getHours());return console.log("hours",ee),a.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&(console.log("bookingDetailRes",r),Q.success("Booking status changed successfully"),q())},[r]),s.jsxs(s.Fragment,{children:[s.jsx(ie,{children:s.jsxs("div",{children:[e&&s.jsxs("div",{className:t.wrapper,children:[s.jsxs("div",{className:t.left_div,children:[s.jsxs("div",{className:t.info,children:[s.jsxs("div",{children:[s.jsxs("h4",{children:["Booking Id: ",e==null?void 0:e.bookingId]}),e.autoAssigned&&s.jsx("p",{style:{color:"green"},children:s.jsx("i",{children:"Auto Assigned"})}),s.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"10px"},children:[s.jsx("h4",{children:"Update Status"}),s.jsxs("select",{value:y,onChange:d=>E(()=>d.target.value),className:t.select,name:"status",id:"status",children:[s.jsx("option",{value:"",children:"Select"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]}),s.jsx("button",{onClick:J,className:t.button,style:{marginLeft:"10px"},children:"Update"})]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Payment Status: ",e==null?void 0:e.paymentStatus]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Amount: ",(P=e==null?void 0:e.refundInfo)==null?void 0:P.amount]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Status: ",(L=e==null?void 0:e.refundInfo)==null?void 0:L.status]})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["Date of Delivery:"," ",C(new Date(e.bookingDate),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Time of Delivery: ",e.bookingTime&&C(new Date(e==null?void 0:e.bookingTime),"hh:mm aa")]}),(!e.sellerId||y==="not-alloted")&&s.jsx("button",{onClick:R,className:t.button,children:"Assign to partner"}),e.sellerId&&y!=="not-alloted"&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h5",{children:"Assigned to Seller"}),s.jsx("p",{children:e.sellerId.name}),s.jsx("p",{children:e.sellerId.phone})]}),s.jsxs("p",{style:{marginTop:"20px"},children:["Date of Booking:"," ",C(new Date(e.createdAt),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Time of Booking: ",e.createdAt&&C(new Date(e==null?void 0:e.createdAt),"hh:mm aa")]})]})]}),s.jsx("h5",{className:t.heading,children:"Products"}),s.jsx("div",{className:t.container,children:s.jsxs("div",{className:t.item,children:[s.jsxs("div",{children:[s.jsx("img",{className:t.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:"product"}),s.jsxs("div",{children:[s.jsx("h6",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?"Package":"Product"})]})]}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]})]})})]}),s.jsxs("div",{className:t.right_div,children:[s.jsxs("div",{className:t.right_div_top,children:[s.jsx("h5",{children:"Booking Summary"}),s.jsxs("div",{className:t.heading,children:[s.jsx("p",{children:"Descriptions"}),s.jsx("p",{children:"Amounts"})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Sub Total :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.orderValue]})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Tax and other charges :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.itemTotalTax]})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Discount :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.itemTotalDiscount]})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Total Amount :"}),s.jsxs("p",{children:["₹",e==null?void 0:e.itemTotalValue]})]})]}),s.jsxs("div",{className:t.right_div_bottom,children:[s.jsx("h5",{children:"Customer Details"}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Name :"}),s.jsx("p",{children:(z=e==null?void 0:e.userId)==null?void 0:z.name})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Phone :"}),s.jsx("p",{children:(B=e==null?void 0:e.userId)==null?void 0:B.phone})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Address :"}),s.jsx("p",{children:`${e.userAddress.addressLine},${e.userAddress.landmark},${e.userAddress.pincode}`})]})]})]})]}),e&&s.jsxs("div",{className:t.location_container,children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Current Location"}),s.jsx("p",{children:"Service Man is on the way..."}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("h6",{children:"Distance :"}),s.jsx("span",{children:u.distance!==""&&u.distance})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("h6",{children:"Time :"}),s.jsx("span",{children:u.time!==""&&u.time})]})]}),s.jsx("div",{children:s.jsx(Le,{sellerStatus:(F=e.currentLocation)==null?void 0:F.status,bookingStatus:e.status,location:{user:(V=(U=e.userAddress)==null?void 0:U.location)==null?void 0:V.coordinates,seller:(k=e.currentLocation)==null?void 0:k.location}})})]})]})}),b&&s.jsx(je,{setIsModalOpen:M,serviceId:e.product?e.product.serviceId:e.package.serviceId,bookingId:e._id,getBooking:q})]})};export{Qe as default};
