import{h as L,r,_ as $,j as s,n as P,u as B,e as R}from"./index-CGylhn6U.js";import{I as F}from"./InvoiceModal-CAltcmI3.js";import{u as S}from"./usePostApiReq-C7INsCRY.js";import{W as V}from"./WebsiteWrapper-DTPL51tP.js";import{A as U}from"./AddReviewModal-DrV-12WN.js";import{A as W,u as Y}from"./index.esm-BJ_kW8OL.js";import{f as y}from"./index-DMx44xLR.js";import"./index.esm-BCgy5go5.js";import"./iconBase-BOE9-_A9.js";import"./jspdf-html2canvas.min-BI9SoT_w.js";import"./index-Bz3gEjcd.js";import"./useDispatch-Dqrl4_SR.js";import"./rolling-white-BBE_8u84.js";import"./Button-BQpLpF18.js";import"./index.esm-Ciysk66U.js";import"./usePatchApiReq-CoISmjAR.js";const G="_booking_details_1dnwf_1",Q="_booking_details_left_1dnwf_23",H="_booking_details_right_1dnwf_31",J="_order_details_1dnwf_39",K="_d_flex_1dnwf_39",X="_delivery_details_1dnwf_51",Z="_booking_details_right_top_1dnwf_53",ss="_h4_1dnwf_71",es="_buttons_container_1dnwf_97",os="_button_1dnwf_97",ns="_red_1dnwf_129",as="_progress_1dnwf_159",ts="_status_container_1dnwf_201",cs="_product_contaner_1dnwf_211",ds="_product_1dnwf_211",rs="_img_1dnwf_245",is="_info_1dnwf_255",ls="_p_1dnwf_159",_s="_link_1dnwf_291",ps="_modal_wrapper_1dnwf_327",us="_modal_1dnwf_327",hs="_button_wrapper_1dnwf_371",fs="_yes_1dnwf_399",gs="_no_1dnwf_409",a={booking_details:G,booking_details_left:Q,booking_details_right:H,order_details:J,d_flex:K,delivery_details:X,booking_details_right_top:Z,h4:ss,buttons_container:es,button:os,red:ns,progress:as,status_container:ts,product_contaner:cs,product:ds,img:rs,info:is,p:ls,link:_s,modal_wrapper:ps,modal:us,button_wrapper:hs,yes:fs,no:gs},xs="_modal_overlay_9z2w0_1",bs="_modal_open_9z2w0_21",js="_modal_close_9z2w0_33",ms="_modal_wrapper_9z2w0_41",ks="_modal_9z2w0_1",vs="_p_9z2w0_99",ws="_mt_9z2w0_111",ys="_rating_container_9z2w0_119",Ns="_button_9z2w0_141",Is="_input_box_9z2w0_165",Ts="_input_9z2w0_165",d={modal_overlay:xs,modal_open:bs,modal_close:js,modal_wrapper:ms,modal:ks,p:vs,mt:ws,rating_container:ys,button:Ns,input_box:Is,input:Ts},Ds=({isAddTicketModalOpen:o,setIsAddTicketModalOpen:p,booking:_,item:e})=>{var x,D,m,C,u,M,b,k,v,j;const{res:i,fetchData:h,isLoading:n}=S(),f=L("userInfo"),N=f==null?void 0:f.id;console.log("booking",_);const[l,I]=r.useState({issue:"",description:"",userId:N,sellerId:((x=_==null?void 0:_.bookingId)==null?void 0:x.sellerId)||"",raisedBy:"customer",bookingId:((D=e==null?void 0:e.bookingId)==null?void 0:D._id)||"",serviceType:e!=null&&e.product?(C=(m=e==null?void 0:e.product)==null?void 0:m.serviceId)==null?void 0:C.categoryId:((M=(u=e==null?void 0:e.package)==null?void 0:u.serviceId)==null?void 0:M.categoryId)||"",ticketType:"Booking",serviceId:e!=null&&e.product?(k=(b=e==null?void 0:e.product)==null?void 0:b.serviceId)==null?void 0:k._id:((j=(v=e==null?void 0:e.package)==null?void 0:v.serviceId)==null?void 0:j._id)||"",date:y(new Date,"dd/MM/yyyy")});console.log("ticketInfo",l);const g=c=>{const{name:w,value:O}=c.target;I({...l,[w]:O})},T=async()=>{if(!l.issue||!l.description){$.error("All fields are required");return}h("/shopping/raise-ticket",l)};return r.useEffect(()=>{((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&(p(!1),$.success("Ticket raised successfully"))},[i]),s.jsx("div",{className:`${d.modal_overlay} ${o?d.modal_open:d.modal_close}`,children:s.jsxs("div",{className:d.modal_wrapper,children:[s.jsx("button",{onClick:()=>p(!1),className:d.modal_close,children:s.jsx(W,{size:20})}),s.jsxs("div",{className:d.modal,children:[s.jsx("p",{className:d.p,children:"Raised Ticket"}),s.jsxs("div",{className:d.mt,children:[s.jsx("label",{htmlFor:"description",children:"Description"}),s.jsx("div",{className:d.input_box,children:s.jsx("input",{className:d.input,onChange:g,value:l.description,type:"text",name:"description",id:"description",placeholder:"Enter your description"})})]}),s.jsxs("div",{className:d.mt,children:[s.jsx("label",{htmlFor:"issue",children:"Issue"}),s.jsx("div",{className:d.input_box,children:s.jsx("input",{className:d.input,onChange:g,value:l.issue,type:"text",name:"issue",id:"issue",placeholder:"Enter the issue"})})]}),s.jsx("button",{onClick:T,className:d.button,children:n?"Loading...":" Proceed"})]})]})})},Cs=({item:o,booking:p})=>{var n;const[_,e]=r.useState(!1),[i,h]=r.useState(!1);return console.log("singleBooking",p),console.log("item",o),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:a.product,children:[s.jsxs("div",{children:[s.jsx("img",{className:a.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${o.package?o.package.imageUrl[0]:o.product.imageUrl[0]}`,alt:""}),s.jsxs("small",{children:["Type:",o.package?"Package":"Product"]})]}),s.jsxs("div",{className:a.info,children:[s.jsx("h5",{children:o.package?o.package.name:o.product.name}),s.jsxs("div",{children:[s.jsx("p",{children:o.bookingId.bookingDate&&y(new Date(o.bookingId.bookingDate),"dd-MM-yyyy")}),s.jsx("p",{children:o.bookingId.bookingTime&&y(new Date(o.bookingId.bookingTime),"hh:mm aa")})]}),s.jsxs("p",{children:["Qty: ",o.quantity]}),s.jsxs("p",{children:["₹",Number(o.package?o.package.offerPrice:o.product.offerPrice)*Number(o.quantity)]}),s.jsxs("div",{style:{display:"flex",gap:"20px",flexDirection:"column"},children:[s.jsx("button",{onClick:()=>e(!0),className:a.button,children:"Add Review"}),s.jsx("button",{onClick:()=>h(!0),className:a.link,children:"Issue with order?"})]})]})]}),_&&s.jsx(U,{isReviewModalOpen:_,setIsReviewModalOpen:e,isBooking:!0,bookingId:(n=o==null?void 0:o.bookingId)==null?void 0:n._id,serviceId:o.package?o.package._id:o.product._id,serviceType:o.package?"package":"product",getAllReviewsOfUser:()=>{}}),i&&s.jsx(Ds,{isAddTicketModalOpen:i,setIsAddTicketModalOpen:h,booking:p,item:o})]})},Ys=()=>{var j;const{res:o,fetchData:p,isLoading:_}=S(),{res:e,fetchData:i,isLoading:h}=Y(),{state:n}=P();B();const f=R();console.log("state",n);const[N,l]=r.useState({}),[I,g]=r.useState(!1),[T,x]=r.useState(!1),[D,m]=r.useState(0),[C,u]=r.useState(0),[M,b]=r.useState(0),k=async()=>{i(`/shopping/get-product-invoice/${n._id}`)};r.useEffect(()=>{var c;((e==null?void 0:e.status)===200||(e==null?void 0:e.status)===201)&&(console.log("getProductInvoiceRes",e),l((c=e==null?void 0:e.data)==null?void 0:c.data))},[e]);const v=async()=>{p(`/shopping/change-order-status/${n._id}`,{status:"Cancelled"})};return r.useEffect(()=>{((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&($.success("Your order cancelled successfully"),f("/my_bookings"))},[o]),r.useEffect(()=>{k();let c=0;for(const t of n.items)t!=null&&t.product?c=c+Number(t.quantity*t.product.offerPrice):t!=null&&t.package&&(c=c+Number(t.quantity*t.package.offerPrice));const w=Number(c)*18/100;m(w),u(()=>c);const{discountType:O,couponFixedValue:A,offPercentage:E,maxDiscount:z}=n.couponId||{};if(n.couponId)if(O==="fixed")b(A),u(t=>t-Number(A));else{let t=Math.ceil(c*(Number(E)/100));t=t>z?z:t,console.log("offerTotal",t),b(t),u(q=>q-Number(t))}},[n.orderValue,n.couponId]),s.jsx(V,{children:s.jsxs("section",{className:a.booking_details,children:[s.jsxs("div",{className:a.booking_details_left,children:[s.jsxs("div",{className:a.order_details,children:[s.jsx("h4",{className:a.h4,children:"Order Details"}),s.jsxs("div",{className:a.d_flex,children:[s.jsxs("div",{children:[s.jsxs("p",{children:["Order Date: ",y(new Date(n.createdAt),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Order ID: ",n.orderId]}),s.jsxs("p",{children:["Order Status: ",n.status]})]}),s.jsxs("div",{className:a.buttons_container,children:[s.jsx("button",{onClick:()=>g(!0),className:a.button,children:"View Invoice"}),n.status!=="Cancelled"&&s.jsx("button",{onClick:()=>x(!0),className:`${a.button} ${a.red}`,children:"Cancel Order"})]})]})]}),s.jsx("div",{className:a.delivery_details,children:s.jsx("div",{className:a.product_contaner,children:(j=n==null?void 0:n.items)==null?void 0:j.map((c,w)=>s.jsx(Cs,{item:c,booking:n}))})})]}),s.jsx("div",{className:a.booking_details_right,children:s.jsxs("div",{className:a.booking_details_right_top,children:[s.jsx("h4",{className:a.h4,children:"Order Total"}),s.jsxs("div",{className:a.d_flex,children:[s.jsxs("div",{children:[s.jsx("p",{children:"Subtotal: "}),s.jsx("p",{children:"Tax and other charges: "}),n.discount>0&&s.jsx("p",{children:"Discount: "}),n.referalDiscount&&s.jsx("p",{children:"Referal Discount: "}),s.jsx("p",{children:s.jsx("b",{children:"Total: "})})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["₹",n.itemTotal]}),s.jsxs("p",{children:[" + ₹",n.tax]}),n.discount>0&&s.jsxs("p",{children:[" - ₹",n.discount]}),n.referalDiscount&&s.jsxs("p",{children:[" - ₹",n.referalDiscount]}),s.jsx("p",{children:s.jsxs("b",{children:["₹",n.orderValue]})})]})]})]})}),I&&s.jsx(F,{state:n,invoice:N,setIsInvoiceModalOpen:g}),T&&s.jsx("div",{className:a.modal_wrapper,children:s.jsxs("div",{className:a.modal,children:[s.jsx("p",{children:"Are you sure to cancel ?"}),s.jsxs("div",{className:a.button_wrapper,children:[s.jsx("button",{onClick:v,className:`${a.button} ${a.yes}`,children:"Yes"}),s.jsx("button",{onClick:()=>x(!1),className:`${a.button} ${a.no}`,children:"No"})]})]})})]})})};export{Ys as default};
