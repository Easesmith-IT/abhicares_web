import{r as n,u as G,j as s,e as v,_ as Y,d as N,o as se}from"./index-DpM_z6IC.js";import{W as te}from"./Wrapper-D8NCHknB.js";import{R as ae}from"./index.esm-BqNeVfbB.js";/* empty css                   */import{u as H}from"./useAuthorization-C9ZZ-i5a.js";import{L as ne}from"./Loader-BcbBY3v3.js";import{f as O}from"./index-hn_tsJ_x.js";import"./logo -C1Nz5jdc.js";import"./LogoutModal-rCWBQ8ER.js";import"./iconBase-BW6_ZAh3.js";const re="_wrapper_ohei2_1",ie="_left_div_ohei2_23",oe="_select_ohei2_37",ce="_info_ohei2_49",le="_heading_ohei2_59",de="_button_ohei2_71",he="_container_ohei2_91",pe="_item_ohei2_115",ue="_img_ohei2_139",me="_right_div_ohei2_149",_e="_right_div_top_ohei2_157",xe="_right_div_bottom_ohei2_159",fe="_d_flex_ohei2_181",je="_location_container_ohei2_269",ge="_location_container_left_ohei2_297",t={wrapper:re,left_div:ie,select:oe,info:ce,heading:le,button:de,container:he,item:pe,img:ue,right_div:me,right_div_top:_e,right_div_bottom:xe,d_flex:fe,location_container:je,location_container_left:ge},ve="_wrapper_qlkv1_1",ye="_modal_qlkv1_27",Ne="_heading_container_qlkv1_47",we="_form_qlkv1_59",Se="_input_container_qlkv1_73",Ce="_input_qlkv1_73",$e="_button_wrapper_qlkv1_105",Ae="_button_qlkv1_105",Ie="_partner_container_qlkv1_131",ke="_partner_qlkv1_131",Pe="_partner_left_qlkv1_165",h={wrapper:ve,modal:ye,heading_container:Ne,form:we,input_container:Se,input:Ce,button_wrapper:$e,button:Ae,partner_container:Ie,partner:ke,partner_left:Pe},De=({setIsModalOpen:c,serviceId:i="",bookingId:e,getBooking:m})=>{const[o,_]=n.useState([]),[l,x]=n.useState(!0);G();const{checkAuthorization:f}=H(),j=async()=>{try{const{data:r}=await v.get(`https://abhicares.com/api/admin/get-seller-list/${i}`,{withCredentials:!0});_(r.data),console.log("seller to assign",r)}catch(r){console.log(r)}finally{x(!1)}};n.useEffect(()=>{j()},[]);const w=async r=>{try{const{data:d}=await v.patch(`https://abhicares.com/api/admin/allot-seller-order/${r}`,{bookingId:e},{withCredentials:!0});console.log(d),Y.success("Order assigned to seller successfully"),m(),c(!1)}catch(d){console.log(d),c(!1),f(d)}};return s.jsx("div",{className:h.wrapper,children:s.jsxs("div",{className:h.modal,children:[s.jsxs("div",{className:h.heading_container,children:[s.jsx("h4",{children:"Assigne Partner"}),s.jsx("div",{className:h.d_flex,children:s.jsx(ae,{onClick:()=>c(!1),cursor:"pointer",size:26})})]}),s.jsxs("div",{className:h.partner_container,children:[!l&&o.length===0&&s.jsx("p",{children:"No seller found for selected service."}),l&&o.length===0&&s.jsx(ne,{}),o&&o.map(r=>s.jsx("div",{className:h.partner,children:s.jsxs("div",{className:h.partner_left,children:[s.jsxs("p",{children:["Seller Name: ",r.name]}),s.jsxs("p",{children:["Seller Phone: ",r.phone]}),s.jsx("button",{onClick:()=>w(r._id),className:h.button,children:"Assign"})]})}))]})]})})},Te=({google:c,location:i,sellerStatus:e,bookingStatus:m})=>{var d,S,C;const[o,_]=n.useState(null),[l,x]=n.useState(!1),f={width:"100%",height:"500px"},j={lat:i.user[0],lng:i.user[1]},w={lat:i.seller[0],lng:i.seller[1]},r=async()=>{const p=`${i.seller[0]},${i.seller[1]}`,y=`${i.user[0]},${i.user[1]}`;try{const{data:u}=await v.get(`https://abhicares.com/api/admin/get-the-path-from-source-to-destination?sourceCoordinates=${p}&destinationCoordinates=${y}`,{withCredentials:!0});u.routes&&u.routes.length>0&&_(u.routes[0].overview_polyline.points)}catch(u){console.log(u)}};return n.useEffect(()=>{r()},[]),n.useEffect(()=>{x(!(e==="out-of-delivery"&&m==="started"))},[e,m]),s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsxs(N.Map,{google:c,zoom:14,style:f,initialCenter:j,children:[s.jsx(N.Marker,{position:j,title:"User",icon:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}}),s.jsx(N.Marker,{position:w,title:"Seller",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}),o&&s.jsx(N.Polyline,{path:o&&((C=(S=(d=c==null?void 0:c.maps)==null?void 0:d.geometry)==null?void 0:S.encoding)==null?void 0:C.decodePath(o)),strokeColor:"#4285F4",strokeOpacity:1,strokeWeight:4})]})}),l&&s.jsx("div",{style:{border:"2px solid",position:"absolute",bottom:0,right:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px",zIndex:1e5},children:"The Seller is not started yet!"})]})},be=N.GoogleApiWrapper({apiKey:"AIzaSyB_ZhYrt0hw7zB74UYGhh4Wt_IkltFzo-I"})(Te),Fe=()=>{var P,D,T,b,L,q,B,M;const{checkAuthorization:c}=H(),{id:i}=se(),[e,m]=n.useState(null),[o,_]=n.useState(!1),[l,x]=n.useState({time:"",distance:""}),[f,j]=n.useState(0),[w,r]=n.useState(0),[d,S]=n.useState(0),C=G(),[p,y]=n.useState((e==null?void 0:e.status)||""),[u,k]=n.useState(!1),A=async()=>{try{_(!0);const{data:a}=await v.get(`https://abhicares.com/api/admin/get-booking-details/${i}`,{withCredentials:!0});m(a.bookingDetails),_(!1),y(a.bookingDetails.status),console.log("booking",a)}catch(a){console.log(a)}},K=async()=>{if(p!=="")try{const{data:a}=await v.patch(`https://abhicares.com/api/admin/update-seller-order-status/${e._id}`,{status:p},{withCredentials:!0});Y.success("Booking status changed successfully"),console.log("status",a),A()}catch(a){console.log(a),y(()=>e==null?void 0:e.status),c(a)}},Q=async()=>{var a,z,E,R,U,V,W,F;try{if(console.log("booking 123",e),e){const I=`${e.currentLocation.location[0]},${e.currentLocation.location[1]}`,X=`${e.userAddress.location.coordinates[0]},${e.userAddress.location.coordinates[1]}`,ee=`https://abhicares.com/api/admin/get-the-distance-routes?origins=${I}&destinations=${X}`,g=await v.get(ee,{withCredentials:!0});x({distance:(R=(E=(z=(a=g==null?void 0:g.data)==null?void 0:a.rows[0])==null?void 0:z.elements[0])==null?void 0:E.distance)==null?void 0:R.text,time:(F=(W=(V=(U=g==null?void 0:g.data)==null?void 0:U.rows[0])==null?void 0:V.elements[0])==null?void 0:W.duration)==null?void 0:F.text})}}catch(I){console.log(I)}};n.useEffect(()=>{o||Q()},[o]),n.useEffect(()=>{A()},[]),n.useEffect(()=>{var a;j((e==null?void 0:e.orderValue)*18/100),r(Number(f)+Number(e==null?void 0:e.orderValue)),e!=null&&e.couponId&&S((e==null?void 0:e.orderValue)*((a=e==null?void 0:e.couponId)==null?void 0:a.offPercentage)/100)},[e==null?void 0:e.orderValue,e==null?void 0:e.couponId,f,C]);const Z=()=>{k(!0)};let $=(e==null?void 0:e.bookingTime)&&new Date(e==null?void 0:e.bookingTime),J=$&&($==null?void 0:$.getHours());return console.log("hours",J),s.jsxs(s.Fragment,{children:[s.jsx(te,{children:s.jsxs("div",{children:[e&&s.jsxs("div",{className:t.wrapper,children:[s.jsxs("div",{className:t.left_div,children:[s.jsxs("div",{className:t.info,children:[s.jsxs("div",{children:[s.jsxs("h4",{children:["Booking Id: ",e==null?void 0:e.bookingId]}),e.autoAssigned&&s.jsx("p",{style:{color:"green"},children:s.jsx("i",{children:"Auto Assigned"})}),s.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"10px"},children:[s.jsx("h4",{children:"Update Status"}),s.jsxs("select",{value:p,onChange:a=>y(()=>a.target.value),className:t.select,name:"status",id:"status",children:[s.jsx("option",{value:"",children:"Select"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]}),s.jsx("button",{onClick:K,className:t.button,style:{marginLeft:"10px"},children:"Update"})]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Payment Status: ",e==null?void 0:e.paymentStatus]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Amount: ",(P=e==null?void 0:e.refundInfo)==null?void 0:P.amount]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Status: ",(D=e==null?void 0:e.refundInfo)==null?void 0:D.status]})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["Date of Booking:"," ",O(new Date(e.bookingDate),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Time of Booking: ",e.bookingTime&&O(new Date(e==null?void 0:e.bookingTime),"hh:mm aa")]}),(!e.sellerId||p==="not-alloted")&&s.jsx("button",{onClick:Z,className:t.button,children:"Assign to partner"}),e.sellerId&&p!=="not-alloted"&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h5",{children:"Assigned to Seller"}),s.jsx("p",{children:e.sellerId.name}),s.jsx("p",{children:e.sellerId.phone})]})]})]}),s.jsx("h5",{className:t.heading,children:"Products"}),s.jsx("div",{className:t.container,children:s.jsxs("div",{className:t.item,children:[s.jsxs("div",{children:[s.jsx("img",{className:t.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:"product"}),s.jsxs("div",{children:[s.jsx("h6",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?"Package":"Product"})]})]}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]})]})})]}),s.jsxs("div",{className:t.right_div,children:[s.jsxs("div",{className:t.right_div_top,children:[s.jsx("h5",{children:"Booking Summary"}),s.jsxs("div",{className:t.heading,children:[s.jsx("p",{children:"Descriptions"}),s.jsx("p",{children:"Amounts"})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Total Amount :"}),s.jsxs("p",{children:["₹",e.orderValue]})]})]}),s.jsxs("div",{className:t.right_div_bottom,children:[s.jsx("h5",{children:"Customer Details"}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Name :"}),s.jsx("p",{children:(T=e==null?void 0:e.userId)==null?void 0:T.name})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Phone :"}),s.jsx("p",{children:(b=e==null?void 0:e.userId)==null?void 0:b.phone})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("p",{children:"Customer Address :"}),s.jsx("p",{children:`${e.userAddress.addressLine},${e.userAddress.landmark},${e.userAddress.pincode}`})]})]})]})]}),e&&s.jsxs("div",{className:t.location_container,children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Current Location"}),s.jsx("p",{children:"Service Man is on the way..."}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("h6",{children:"Distance :"}),s.jsx("span",{children:l.distance!==""&&l.distance})]}),s.jsxs("div",{className:t.d_flex,children:[s.jsx("h6",{children:"Time :"}),s.jsx("span",{children:l.time!==""&&l.time})]})]}),s.jsx("div",{children:s.jsx(be,{sellerStatus:(L=e.currentLocation)==null?void 0:L.status,bookingStatus:e.status,location:{user:(B=(q=e.userAddress)==null?void 0:q.location)==null?void 0:B.coordinates,seller:(M=e.currentLocation)==null?void 0:M.location}})})]})]})}),u&&s.jsx(De,{setIsModalOpen:k,serviceId:e.product?e.product.serviceId:e.package.serviceId,bookingId:e._id,getBooking:A})]})};export{Fe as default};
