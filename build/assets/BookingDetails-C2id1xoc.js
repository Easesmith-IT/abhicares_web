import{r as t,_ as K,j as s,d as y,u as se,e as te}from"./index-BgkP9pz8.js";import{R as ne}from"./index.esm-BP34_6mW.js";/* empty css                   */import{u as ae}from"./useAuthorization-tWnY0z3a.js";import{L as re}from"./Loader-DZZMpz-K.js";import{u as Q}from"./usePatchApiReq-DS05ZUpu.js";import{u as C}from"./index.esm-DnL9X2Ej.js";import{W as ie}from"./Wrapper-DS_6NVVl.js";import{f as H}from"./index-DtcRJE1u.js";import"./iconBase-BAuAS9aP.js";import"./logo -C1Nz5jdc.js";const oe="_wrapper_qlkv1_1",ce="_modal_qlkv1_27",le="_heading_container_qlkv1_47",de="_form_qlkv1_59",ue="_input_container_qlkv1_73",he="_input_qlkv1_73",pe="_button_wrapper_qlkv1_105",_e="_button_qlkv1_105",me="_partner_container_qlkv1_131",xe="_partner_qlkv1_131",fe="_partner_left_qlkv1_165",p={wrapper:oe,modal:ce,heading_container:le,form:de,input_container:ue,input:he,button_wrapper:pe,button:_e,partner_container:me,partner:xe,partner_left:fe},je=({setIsModalOpen:n,serviceId:l="",bookingId:_,getBooking:i})=>{const[o,N]=t.useState([]),{res:r,fetchData:m,isLoading:x}=C();ae();const e=async()=>{m(`/admin/get-seller-list/${l}`)};t.useEffect(()=>{e()},[]),t.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&N(r==null?void 0:r.data.data)},[r]);const{res:c,fetchData:h}=Q(),f=async u=>{await h(`/admin/allot-seller-order/${u}`,{bookingId:_})};return t.useEffect(()=>{((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&(console.log("assignPartnerRes",c),K.success("Order assigned to seller successfully"),i(),n(!1))},[c]),s.jsx("div",{className:p.wrapper,children:s.jsxs("div",{className:p.modal,children:[s.jsxs("div",{className:p.heading_container,children:[s.jsx("h4",{children:"Assigne Partner"}),s.jsx("div",{className:p.d_flex,children:s.jsx(ne,{onClick:()=>n(!1),cursor:"pointer",size:26})})]}),s.jsxs("div",{className:p.partner_container,children:[!x&&o.length===0&&s.jsx("p",{children:"No seller found for selected service."}),x&&o.length===0&&s.jsx(re,{}),o&&o.map(u=>s.jsx("div",{className:p.partner,children:s.jsxs("div",{className:p.partner_left,children:[s.jsxs("p",{children:["Seller Name: ",u.name]}),s.jsxs("p",{children:["Seller Phone: ",u.phone]}),s.jsx("button",{onClick:()=>f(u._id),className:p.button,children:"Assign"})]})}))]})]})})},ve="_wrapper_ohei2_1",ge="_left_div_ohei2_23",ye="_select_ohei2_37",Ne="_info_ohei2_49",we="_heading_ohei2_59",Ae="_button_ohei2_71",Se="_container_ohei2_91",Ce="_item_ohei2_115",$e="_img_ohei2_139",Ie="_right_div_ohei2_149",Te="_right_div_top_ohei2_157",ke="_right_div_bottom_ohei2_159",qe="_d_flex_ohei2_181",Ee="_location_container_ohei2_269",Pe="_location_container_left_ohei2_297",a={wrapper:ve,left_div:ge,select:ye,info:Ne,heading:we,button:Ae,container:Se,item:Ce,img:$e,right_div:Ie,right_div_top:Te,right_div_bottom:ke,d_flex:qe,location_container:Ee,location_container_left:Pe},De=({google:n,location:l,sellerStatus:_,bookingStatus:i})=>{var I,w,T;const{res:o,fetchData:N,isLoading:r}=C(),[m,x]=t.useState(null),[e,c]=t.useState(!1),h={width:"100%",height:"500px"},f={lat:l.user[0],lng:l.user[1]},u={lat:l.seller[0],lng:l.seller[1]},$=async()=>{const j=`${l.seller[0]},${l.seller[1]}`,v=`${l.user[0]},${l.user[1]}`;N(`/admin/get-the-path-from-source-to-destination?sourceCoordinates=${j}&destinationCoordinates=${v}`)};return t.useEffect(()=>{$()},[]),t.useEffect(()=>{var j,v;((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&x((v=(j=o==null?void 0:o.data.routes[0])==null?void 0:j.overview_polyline)==null?void 0:v.points)},[o]),t.useEffect(()=>{c(!(_==="out-of-delivery"&&i==="started"))},[_,i]),s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsxs(y.Map,{google:n,zoom:14,style:h,initialCenter:f,children:[s.jsx(y.Marker,{position:f,title:"User",icon:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}}),s.jsx(y.Marker,{position:u,title:"Seller",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}),m&&s.jsx(y.Polyline,{path:m&&((T=(w=(I=n==null?void 0:n.maps)==null?void 0:I.geometry)==null?void 0:w.encoding)==null?void 0:T.decodePath(m)),strokeColor:"#4285F4",strokeOpacity:1,strokeWeight:4})]})}),e&&s.jsx("div",{style:{border:"2px solid",position:"absolute",bottom:0,right:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px",zIndex:1e5},children:"The Seller is not started yet!"})]})},Le=y.GoogleApiWrapper({apiKey:"AIzaSyB_ZhYrt0hw7zB74UYGhh4Wt_IkltFzo-I"})(De),He=()=>{var P,D,L,M,b,z,B,F;const{res:n,fetchData:l,isLoading:_}=C(),{res:i,fetchData:o,isLoading:N}=C(),{res:r,fetchData:m}=Q(),{id:x}=se(),[e,c]=t.useState(null),[h,f]=t.useState({time:"",distance:""}),[u,$]=t.useState(0),[I,w]=t.useState(0),[T,j]=t.useState(0),v=te(),[g,q]=t.useState((e==null?void 0:e.status)||""),[Z,E]=t.useState(!1),k=async()=>{l(`/admin/get-booking-details/${x}`)};t.useEffect(()=>{((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(c(n==null?void 0:n.data.bookingDetails),q(n==null?void 0:n.data.bookingDetails.status))},[n]);const J=async()=>{g!==""&&await m(`/admin/update-seller-order-status/${e._id}`,{status:g})},X=async()=>{try{if(console.log("booking 123",e),e){const d=`${e.currentLocation.location[0]},${e.currentLocation.location[1]}`,S=`${e.userAddress.location.coordinates[0]},${e.userAddress.location.coordinates[1]}`;o(`/admin/get-the-distance-routes?origins=${d}&destinations=${S}`)}}catch(d){console.log(d)}};t.useEffect(()=>{_||X()},[_]),t.useEffect(()=>{var d,S,U,V,W,O,G,Y;((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&f({distance:(V=(U=(S=(d=i==null?void 0:i.data)==null?void 0:d.rows[0])==null?void 0:S.elements[0])==null?void 0:U.distance)==null?void 0:V.text,time:(Y=(G=(O=(W=i==null?void 0:i.data)==null?void 0:W.rows[0])==null?void 0:O.elements[0])==null?void 0:G.duration)==null?void 0:Y.text})},[i]),t.useEffect(()=>{k()},[]),t.useEffect(()=>{var d;$((e==null?void 0:e.orderValue)*18/100),w(Number(u)+Number(e==null?void 0:e.orderValue)),e!=null&&e.couponId&&j((e==null?void 0:e.orderValue)*((d=e==null?void 0:e.couponId)==null?void 0:d.offPercentage)/100)},[e==null?void 0:e.orderValue,e==null?void 0:e.couponId,u,v]);const R=()=>{E(!0)};let A=(e==null?void 0:e.bookingTime)&&new Date(e==null?void 0:e.bookingTime),ee=A&&(A==null?void 0:A.getHours());return console.log("hours",ee),t.useEffect(()=>{((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&(console.log("bookingDetailRes",r),K.success("Booking status changed successfully"),k())},[r]),s.jsxs(s.Fragment,{children:[s.jsx(ie,{children:s.jsxs("div",{children:[e&&s.jsxs("div",{className:a.wrapper,children:[s.jsxs("div",{className:a.left_div,children:[s.jsxs("div",{className:a.info,children:[s.jsxs("div",{children:[s.jsxs("h4",{children:["Booking Id: ",e==null?void 0:e.bookingId]}),e.autoAssigned&&s.jsx("p",{style:{color:"green"},children:s.jsx("i",{children:"Auto Assigned"})}),s.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"10px"},children:[s.jsx("h4",{children:"Update Status"}),s.jsxs("select",{value:g,onChange:d=>q(()=>d.target.value),className:a.select,name:"status",id:"status",children:[s.jsx("option",{value:"",children:"Select"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]}),s.jsx("button",{onClick:J,className:a.button,style:{marginLeft:"10px"},children:"Update"})]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Payment Status: ",e==null?void 0:e.paymentStatus]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Amount: ",(P=e==null?void 0:e.refundInfo)==null?void 0:P.amount]}),s.jsxs("p",{style:{marginTop:"10px"},children:["Refund Status: ",(D=e==null?void 0:e.refundInfo)==null?void 0:D.status]})]}),s.jsxs("div",{children:[s.jsxs("p",{children:["Date of Booking:"," ",H(new Date(e.bookingDate),"dd-MM-yyyy")]}),s.jsxs("p",{children:["Time of Booking: ",e.bookingTime&&H(new Date(e==null?void 0:e.bookingTime),"hh:mm aa")]}),(!e.sellerId||g==="not-alloted")&&s.jsx("button",{onClick:R,className:a.button,children:"Assign to partner"}),e.sellerId&&g!=="not-alloted"&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h5",{children:"Assigned to Seller"}),s.jsx("p",{children:e.sellerId.name}),s.jsx("p",{children:e.sellerId.phone})]})]})]}),s.jsx("h5",{className:a.heading,children:"Products"}),s.jsx("div",{className:a.container,children:s.jsxs("div",{className:a.item,children:[s.jsxs("div",{children:[s.jsx("img",{className:a.img,src:`https://storage.googleapis.com/abhicares-backend-bucket/${e.package?e.package.imageUrl[0]:e.product.imageUrl[0]}`,alt:"product"}),s.jsxs("div",{children:[s.jsx("h6",{children:e.package?e.package.name:e.product.name}),s.jsx("p",{children:e.package?"Package":"Product"})]})]}),s.jsxs("p",{children:["Qty: ",e.quantity]}),s.jsxs("p",{children:["₹",Number(e.package?e.package.offerPrice:e.product.offerPrice)*Number(e.quantity)]})]})})]}),s.jsxs("div",{className:a.right_div,children:[s.jsxs("div",{className:a.right_div_top,children:[s.jsx("h5",{children:"Booking Summary"}),s.jsxs("div",{className:a.heading,children:[s.jsx("p",{children:"Descriptions"}),s.jsx("p",{children:"Amounts"})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Total Amount :"}),s.jsxs("p",{children:["₹",e.orderValue]})]})]}),s.jsxs("div",{className:a.right_div_bottom,children:[s.jsx("h5",{children:"Customer Details"}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Customer Name :"}),s.jsx("p",{children:(L=e==null?void 0:e.userId)==null?void 0:L.name})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Customer Phone :"}),s.jsx("p",{children:(M=e==null?void 0:e.userId)==null?void 0:M.phone})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("p",{children:"Customer Address :"}),s.jsx("p",{children:`${e.userAddress.addressLine},${e.userAddress.landmark},${e.userAddress.pincode}`})]})]})]})]}),e&&s.jsxs("div",{className:a.location_container,children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Current Location"}),s.jsx("p",{children:"Service Man is on the way..."}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("h6",{children:"Distance :"}),s.jsx("span",{children:h.distance!==""&&h.distance})]}),s.jsxs("div",{className:a.d_flex,children:[s.jsx("h6",{children:"Time :"}),s.jsx("span",{children:h.time!==""&&h.time})]})]}),s.jsx("div",{children:s.jsx(Le,{sellerStatus:(b=e.currentLocation)==null?void 0:b.status,bookingStatus:e.status,location:{user:(B=(z=e.userAddress)==null?void 0:z.location)==null?void 0:B.coordinates,seller:(F=e.currentLocation)==null?void 0:F.location}})})]})]})}),Z&&s.jsx(je,{setIsModalOpen:E,serviceId:e.product?e.product.serviceId:e.package.serviceId,bookingId:e._id,getBooking:k})]})};export{He as default};
