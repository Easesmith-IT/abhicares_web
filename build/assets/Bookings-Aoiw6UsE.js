import{r as c,j as t,e as F}from"./index-eSIAY8Uv.js";import{W as O}from"./Wrapper-C_MBzJws.js";import{u as g,h as L}from"./index.esm-DOqJpdRb.js";import{L as V}from"./Loader-BUdzUg4g.js";import{c as a}from"./Shared.module-DD54I-nI.js";import{P as q}from"./react-bootstrap-pagination-control.esm-DaLKDnki.js";import{e as U}from"./index.esm-Cb-S6fGP.js";import{h as W}from"./jspdf-html2canvas.min-5VJtEYu6.js";import{R as Y}from"./index.esm-DgtiecaY.js";import{u as z}from"./usePostApiReq-CCJmJfW3.js";import{f as p}from"./index-BFFTBMbo.js";import"./logo -C1Nz5jdc.js";import"./useDispatch-BjeBiUzI.js";import"./iconBase-BPNpYAOT.js";const G="_wrapper_7u2da_1",H="_modal_7u2da_27",J="_heading_container_7u2da_45",K="_contianer_7u2da_61",Q="_mt_7u2da_87",X="_btn_container_7u2da_95",Z="_button_7u2da_109",B="_table_wrapper_7u2da_125",k="_table_7u2da_125",R="_d_flex_7u2da_151",h={wrapper:G,modal:H,heading_container:J,contianer:K,mt:Q,btn_container:X,button:Z,table_wrapper:B,table:k,d_flex:R},tt=({setIsModalOpen:n})=>{const{res:i,fetchData:m,isLoading:l}=z(),[j,y]=c.useState(""),[d,N]=c.useState([]),f=()=>{W(document.querySelector("#table"),{jsPDF:{format:"a4"},imageType:"image/jpeg",output:"./pdf/generate.pdf"})},o=e=>{y(e.target.value)},x=async()=>{if(!j)return;const e=j.split("-");m("/admin/get-monthly-bookings",{month:e[1],year:e[0]})};return c.useEffect(()=>{((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&(n(!0),N(i==null?void 0:i.data.data))},[i]),t.jsx("div",{className:h.wrapper,children:t.jsxs("div",{className:h.modal,children:[t.jsxs("div",{className:h.heading_container,children:[t.jsx("h4",{children:"Monthly Bookings"}),t.jsxs("div",{className:h.d_flex,children:[t.jsxs("div",{className:a.d_flex,children:[t.jsx("input",{onChange:o,type:"month",name:"month",id:"month"}),t.jsx("button",{onClick:x,children:l?"Loading...":"Submit"})]}),t.jsx(Y,{onClick:()=>n(!1),cursor:"pointer",size:26})]})]}),d.length===0&&t.jsx("p",{style:{padding:"0px 0px 20px 20px"},children:"No bookings found."}),d.length>0&&t.jsxs("div",{className:a["report-body"],children:[t.jsx("div",{id:"table",className:h.table_wrapper,children:t.jsxs("table",{border:"2px",className:h.table,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Booking Id"}),t.jsx("th",{children:"Booking Date"}),t.jsx("th",{children:"Delivery Date"}),t.jsx("th",{children:"Total Value"}),t.jsx("th",{children:"Booking Time"}),t.jsx("th",{children:"User Name"}),t.jsx("th",{children:"User Mobile"})]})}),t.jsx("tbody",{children:d.map(e=>{var u,_;return t.jsxs("tr",{children:[t.jsx("td",{style:{width:"210px",paddingInline:"10px"},children:e==null?void 0:e.bookingId}),t.jsx("td",{style:{width:"160px"},children:p(new Date(e==null?void 0:e.createdAt),"dd-MM-yyyy")}),t.jsx("td",{style:{width:"160px"},children:p(new Date(e==null?void 0:e.bookingDate),"dd-MM-yyyy")}),t.jsx("td",{children:e==null?void 0:e.itemTotalValue}),t.jsx("td",{children:(e==null?void 0:e.bookingTime)&&p(new Date(e.bookingTime),"hh.mm aaaaa'm'")}),t.jsx("td",{children:(u=e==null?void 0:e.userId)==null?void 0:u.name}),t.jsx("td",{children:(_=e==null?void 0:e.userId)==null?void 0:_.phone})]})})})]})}),t.jsx("div",{className:h.btn_container,children:t.jsx("button",{className:h.button,onClick:f,children:"Download"})})]})]})})},mt=()=>{const{res:n,fetchData:i,isLoading:m}=g(),{res:l,fetchData:j,isLoading:y}=g(),{res:d,fetchData:N,isLoading:f}=g(),[o,x]=c.useState([]),[e,u]=c.useState({date:"",status:""}),[_,D]=c.useState(!1),[$,w]=c.useState(1),[v,I]=c.useState(1),S=async s=>{I(s)};console.log("filters",e);const C=s=>{const{name:r,value:E}=s.target;u({...e,[r]:E})},P=F(),b=c.useRef(),M=async()=>{i(`/admin/get-booking-list?page=${v}`)};c.useEffect(()=>{var s,r;((n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201)&&(console.log("getBookingListRes",n),x(n==null?void 0:n.data.data),w((r=(s=n==null?void 0:n.data)==null?void 0:s.pagination)==null?void 0:r.totalPages))},[n]);const A=async()=>{j(`/admin/search-filter-bookings?status=${e.status}&bookingDate=${e.date}&page=${v}`)};c.useEffect(()=>{var s,r;((l==null?void 0:l.status)===200||(l==null?void 0:l.status)===201)&&(w((r=(s=l==null?void 0:l.data)==null?void 0:s.pagination)==null?void 0:r.totalPages),x(l==null?void 0:l.data.data))},[l]),c.useEffect(()=>{e.date||e.status?A():M()},[e.date,e.status,v]);const T=async()=>{const s=b.current.value;if(!s){M();return}N(`/admin/get-booking-by-id?bookingId=${s}`)};return c.useEffect(()=>{((d==null?void 0:d.status)===200||(d==null?void 0:d.status)===201)&&x(d==null?void 0:d.data.data)},[d]),t.jsxs(t.Fragment,{children:[t.jsx(O,{children:t.jsxs("div",{className:a["report-container"],children:[t.jsxs("div",{className:a["report-header"],children:[t.jsx("h1",{className:a["recent-Articles"],children:"Bookings"}),t.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center"},children:[t.jsxs("div",{className:"d-flex",style:{position:"relative"},children:[t.jsx("input",{ref:b,style:{width:"300px",padding:"5px 10px",borderRadius:"5px"},type:"text",placeholder:"search booking by id"}),t.jsx(L,{onClick:T,style:{position:"absolute",right:"8px",top:"10px",cursor:"pointer"}})]}),t.jsx("input",{type:"date",name:"date",value:e.date,onChange:C,className:a.filter_input}),t.jsx("button",{onClick:()=>u({...e,date:p(new Date,"yyyy-MM-dd")}),style:{background:"black",color:"white",padding:"5px 20px",borderRadius:"6px"},children:"Todays Bookings"}),t.jsxs("select",{name:"status",value:e.status,onChange:C,className:a.filter_input,children:[t.jsx("option",{value:"",children:"Select Status"}),t.jsx("option",{value:"cancelled",children:"Cancelled"}),t.jsx("option",{value:"alloted",children:"Alloted"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"not-alloted",children:"Not Alloted"})]}),t.jsx("div",{className:a.d_flex,children:t.jsx("button",{onClick:()=>D(!0),children:t.jsx(U,{})})})]})]}),t.jsxs("div",{className:a["report-body"],children:[t.jsxs("div",{className:a["report-topic-heading"],children:[t.jsx("h3",{className:a["t-op"],style:{width:"200px"},children:"Booking Id"}),t.jsx("h3",{className:a["t-op"],children:"Delivery Date"}),t.jsx("h3",{className:a["t-op"],children:"Booking Date"}),t.jsx("h3",{className:`${a["t-op"]}`,children:"Status"}),t.jsx("h3",{className:`${a["t-op"]}`,children:"Booking Value"}),t.jsx("h3",{className:a["t-op"],children:"Details"})]}),t.jsxs("div",{className:a.items,children:[!m&&!y&&!f&&(o==null?void 0:o.length)===0&&t.jsx("p",{children:"No bookings found"}),(m||y||f)&&t.jsx(V,{}),o==null?void 0:o.map((s,r)=>t.jsxs("div",{className:`${a.item1} ${a.cursor}`,children:[t.jsx("h3",{className:`${a["t-op-nextlvl"]}`,style:{width:"200px"},children:s.bookingId}),t.jsxs("h3",{className:a["t-op-nextlvl"],children:[t.jsx("span",{style:{color:"green"},children:s.autoAssigned&&"auto"})," ",p(new Date(s==null?void 0:s.bookingDate),"dd-MM-yyyy")]}),t.jsxs("h3",{className:a["t-op-nextlvl"],children:[" ",p(new Date(s==null?void 0:s.createdAt),"dd-MM-yyyy")]}),t.jsx("h3",{className:`${a["t-op-nextlvl"]} ${a.status} ${s.status==="cancelled"?a.Cancelled:s.status==="completed"?a.Completed:s.status==="alloted"?a.alloted:a.OutOfDelivery}`,children:s.status}),t.jsxs("h3",{className:`${a["t-op-nextlvl"]}`,children:["â‚¹",s.orderValue]}),t.jsx("h3",{className:a["t-op-nextlvl"],children:t.jsx("button",{onClick:()=>P(`/admin/bookings/${s._id}`,{state:s}),className:a.button,children:"View Details"})})]},r))]}),t.jsx("div",{style:{marginTop:"20px"},children:t.jsx(q,{changePage:S,limit:10,page:v,total:$+"0"})})]})]})}),_&&t.jsx(tt,{setIsModalOpen:D})]})};export{mt as default};
