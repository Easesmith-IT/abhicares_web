import{r as l,e as $,_ as F,j as e}from"./index-B-IXA8Ie.js";import{p as z}from"./index-BzzzayLF.js";import{W,c as _}from"./Wrapper-MkLY3g7U.js";import{F as B}from"./index.esm-BMR3ZfE0.js";import{u as q,a as G}from"./index.esm-BbyRK8SJ.js";import{A as Q}from"./add-icon-nobg-CDiYK8IX.js";import{R as H}from"./index.esm-UZTkdxOj.js";import{R as J}from"./index-BePlCa_-.js";/* empty css                   */import{u as K}from"./useAuthorization-DJfWabbS.js";import{u as X}from"./usePatchApiReq-CFyoLoKy.js";import{u as Y}from"./usePostApiReq-BqGvxZz6.js";import{D as Z}from"./DeleteModal-C90xvr-R.js";import{L as R}from"./Loader-BC-JdY3x.js";import{u as ee}from"./useDeleteApiReq-Cdh8879L.js";import{P as se}from"./react-bootstrap-pagination-control.esm-BkNEHDtK.js";import"./logo -C1Nz5jdc.js";import"./useDispatch-C5OFXrAN.js";import"./iconBase-3hUsnpgH.js";const te="_container_14vyw_1",ae="_city_14vyw_17",ne="_d_flex_14vyw_39",ie="_p_14vyw_51",ce="_city_right_14vyw_61",f={container:te,city:ae,d_flex:ne,p:ie,city_right:ce},le="_wrapper_89j9y_1",oe="_modal_89j9y_27",re="_heading_container_89j9y_47",de="_form_89j9y_59",pe="_input_container_89j9y_73",ue="_input_89j9y_73",he="_button_wrapper_89j9y_105",me="_button_89j9y_105",xe="_categories_89j9y_131",c={wrapper:le,modal:oe,heading_container:re,form:de,input_container:pe,input:ue,button_wrapper:he,button:me,categories:xe},ge=o=>{const s=/\s/.test(o),N=[...o].every(i=>i===i.toUpperCase());return!!(!s&&N)};function je(o){return o.toUpperCase().replace(/\s+/g,"")}const k=({setIsModalOpen:o,offer:s="",getAllOffers:N})=>{const{res:i,fetchData:w,isLoading:S}=Y(),{res:r,fetchData:A,isLoading:P}=q();K();const[y,v]=l.useState((s==null?void 0:s.description)||""),[u,T]=l.useState((s==null?void 0:s.categoryType)||[]);l.useState(!1);const[t,b]=l.useState({name:(s==null?void 0:s.name)||"",offPercentage:(s==null?void 0:s.offPercentage)||"",noOfTimesPerUser:(s==null?void 0:s.noOfTimesPerUser)||1,status:(s==null?void 0:s.status)||!0,type:(s==null?void 0:s.discountType)||"",upTo:(s==null?void 0:s.maxDiscount)||"",offerValue:(s==null?void 0:s.fixedCouponValue)||"",categoryType:u}),[g,U]=l.useState([]),m=a=>{let{name:p,value:d}=a.target;p==="name"&&(d=je(d)),b({...t,[p]:d})},C=async()=>{A("/admin/get-all-category")};l.useEffect(()=>{C()},[]),l.useEffect(()=>{var a;((r==null?void 0:r.status)===200||(r==null?void 0:r.status)===201)&&U((a=r==null?void 0:r.data)==null?void 0:a.data)},[r]),$(),console.log("selectedItems",u),console.log("offerInfo",t);const M=a=>{const{value:p,checked:d}=a.target;T(d?j=>[...j,p]:j=>j.filter(O=>O!==p))},{res:h,fetchData:x}=X(),V=async a=>{a.preventDefault();const{name:p,offPercentage:d,type:j,offerValue:O,upTo:I,noOfTimesPerUser:n,categoryType:D}=t,L=!p||!j||!n||u.length===0||(j==="percentage"?!d||!I:!O),E=!y;if(console.log("isDescriptionMissing",E),console.log("isOfferMissing",L),console.log("isOfferMissing || isDescriptionMissing",L||E),L||E){F.error("All fields are required");return}if(!ge(t.name)){F.error("Please enter valid coupon code");return}s?await x("/admin/update-coupon",{...t,description:y,maxDiscount:t.type==="fixed"?"":t.upTo,discountType:t.type,couponFixedValue:t.type==="fixed"?t.offerValue:"",categoryType:u,offPercentage:t.type==="fixed"?"":t.offPercentage,id:s._id}):w("/admin/create-coupon",{...t,description:y,maxDiscount:t.type==="fixed"?"":t.upTo,discountType:t.type,couponFixedValue:t.type==="fixed"?t.offerValue:"",categoryType:u,offPercentage:t.type==="fixed"?"":t.offPercentage})};return l.useEffect(()=>{((h==null?void 0:h.status)===200||(h==null?void 0:h.status)===201)&&(console.log("updateOfferRes",h),F.success("Offer updated successfully"),N(),o(!1))},[h]),l.useEffect(()=>{((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&(F.success("Offer added successfully"),N(),o(!1))},[i]),e.jsx("div",{className:c.wrapper,children:e.jsxs("div",{className:c.modal,children:[e.jsxs("div",{className:c.heading_container,children:[e.jsxs("h4",{children:[s?"Update":"Add"," Offer"]}),e.jsx("div",{className:c.d_flex,children:e.jsx(H,{onClick:()=>o(!1),cursor:"pointer",size:26})})]}),e.jsxs("form",{onSubmit:V,className:c.form,children:[e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"name",children:"Coupon Code (in block letters and without space)"}),e.jsx("input",{className:c.input,onChange:m,value:t.name,type:"text",name:"name",id:"name"})]}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"categoryType",children:"Category"}),e.jsxs("div",{className:c.categories,children:[g.length>0&&!P&&(g==null?void 0:g.map(a=>e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{style:{width:"20px",height:"20px"},type:"checkbox",value:a==null?void 0:a._id,id:a==null?void 0:a._id,name:a==null?void 0:a._id,checked:u.some(p=>p===(a==null?void 0:a._id)),onChange:M}),e.jsx("label",{htmlFor:a==null?void 0:a._id,children:a==null?void 0:a.name})]}))),g.length===0&&P&&e.jsx("p",{children:"Loading..."}),g.length===0&&!P&&e.jsx("p",{children:"No Categories found"})]})]}),!s&&e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"type",children:"Coupon Type"}),e.jsxs("select",{className:c.input,onChange:m,value:t.type,name:"type",id:"type",children:[e.jsx("option",{value:"",children:"Select Coupon Type"}),e.jsx("option",{value:"percentage",children:"Percentage"}),e.jsx("option",{value:"fixed",children:"Fixed"})]})]}),t.type==="percentage"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"offPercentage",children:"Offer Percentage"}),e.jsx("input",{className:c.input,onChange:m,value:t.offPercentage,type:"number",name:"offPercentage",id:"offPercentage"})]}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"upTo",children:"Up To"}),e.jsx("input",{className:c.input,onChange:m,value:t.upTo,type:"number",name:"upTo",id:"upTo"})]})]}),t.type==="fixed"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"offerValue",children:"Offer Value"}),e.jsx("input",{className:c.input,onChange:m,value:t.offerValue,type:"number",name:"offerValue",id:"offerValue"})]})}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"noOfTimesPerUser",children:"No of Times Per User"}),e.jsx("input",{className:c.input,onChange:m,value:t.noOfTimesPerUser,type:"number",name:"noOfTimesPerUser",id:"noOfTimesPerUser"})]}),s&&e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{className:c.input,onChange:m,value:t.status,name:"status",id:"status",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),e.jsxs("div",{className:c.input_container,children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx(J,{theme:"snow",value:y,onChange:v})]}),e.jsx("div",{className:c.button_wrapper,children:e.jsx("button",{className:c.button,children:S?"Loading...":s?"Update":"Add"})})]})]})})},Le=()=>{const{res:o,fetchData:s,isLoading:N}=ee(),{res:i,fetchData:w,isLoading:S}=q(),[r,A]=l.useState(!1),[P,y]=l.useState(!1),[v,u]=l.useState(!1),[T,t]=l.useState({}),[b,g]=l.useState([]),[U,m]=l.useState(1),[C,M]=l.useState(1),h=async n=>{M(n)},[x,V]=l.useState([]),[a,p]=l.useState("all");l.useEffect(()=>{const n=b.filter(D=>D.status===a);V(a==="all"?b:n)},[a,b]),console.log("filteredCoupons",x);const d=async()=>{w(`/admin/get-coupons?page=${C}`)};l.useEffect(()=>{d()},[C]),l.useEffect(()=>{var n,D;((i==null?void 0:i.status)===200||(i==null?void 0:i.status)===201)&&(console.log("getCouponsRes",i),m((D=(n=i==null?void 0:i.data)==null?void 0:n.pagination)==null?void 0:D.totalPages),g(i==null?void 0:i.data.data))},[i]);const j=n=>{t(n),y(!v)},O=n=>{t(n),u(!v)},I=async()=>{s(`/admin/delete-coupon/${T}`)};return l.useEffect(()=>{((o==null?void 0:o.status)===200||(o==null?void 0:o.status)===201)&&(F.success("Offer deleted successfully"),d(),u(!v))},[o]),e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs("div",{className:_["report-container"],children:[e.jsxs("div",{className:_["report-header"],children:[e.jsx("h1",{className:_["recent-Articles"],children:"Offers"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsxs("select",{className:_.input,onChange:n=>p(n.target.value),value:a,children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx("button",{onClick:()=>A(!0),className:_.services_add_btn,children:e.jsx("img",{src:Q,alt:"add"})})]})]}),S&&e.jsx(R,{}),e.jsxs("div",{className:f.container,children:[!S&&(x==null?void 0:x.length)===0&&e.jsx("p",{children:"No offers found"}),x==null?void 0:x.map(n=>e.jsxs("div",{className:f.city,children:[e.jsxs("div",{className:f.city_left,children:[e.jsx("h5",{children:n.name}),e.jsxs("div",{className:f.d_flex,children:[(n==null?void 0:n.discountType)==="fixed"?e.jsxs("p",{children:["â‚¹",n.couponFixedValue]}):e.jsxs("p",{children:[n.offPercentage,"%"]}),e.jsx("p",{className:`${_.status} ${n.status==="active"?_.active:_.inactive}`,children:n.status})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Type:"})," ",n==null?void 0:n.discountType]}),e.jsx("p",{className:f.p,children:z(n.description)})]}),e.jsxs("div",{className:f.city_right,children:[e.jsx(B,{onClick:()=>j(n),cursor:"pointer",size:20}),e.jsx(G,{onClick:()=>O(n._id),cursor:"pointer",size:22,color:"red"})]})]},n._id))]}),e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(se,{changePage:h,limit:10,page:C,total:U+"0"})})]})}),r&&e.jsx(k,{setIsModalOpen:A,getAllOffers:d}),P&&e.jsx(k,{setIsModalOpen:y,getAllOffers:d,offer:T}),v&&e.jsx(Z,{handleDelete:I,setState:u})]})};export{Le as default};
